import{r as i,j as e}from"./app-pP88dXXD.js";import{S as R}from"./steps.esm-CxvGHh6C.js";import{D as _}from"./divider.esm-CVbXKVbH.js";import{D as G}from"./dropdown.esm-BsJPZvZJ.js";import{F as b}from"./floatlabel.esm-Bqjmmks2.js";import{B as f}from"./button.esm-CvuNJ5B9.js";import{M as $}from"./multiselect.esm-SddbgUdU.js";import{D as H}from"./datatable.esm-IL7QhP4E.js";import{C as m}from"./column.esm-Doa4u4hv.js";import{I as K}from"./inputnumber.esm-COJVyWG0.js";import{I as J}from"./inputtextarea.esm-TZ2lf9wj.js";import"./ripple.esm-3EqM4Xiq.js";import"./index.esm-BeeN0Y3e.js";import"./index.esm-CK0Cgr2r.js";import"./index.esm-BpWSIr-U.js";import"./overlayservice.esm-Bi8lrQ5u.js";import"./tooltip.esm-CzuGfRo8.js";import"./csstransition.esm-BBfra-DH.js";import"./index.esm-yMs_xicw.js";import"./index.esm-Dml4Rf6J.js";import"./inputtext.esm-CUVRfrTN.js";import"./paginator.esm-plLA5Nda.js";import"./index.esm-CXAUaRz9.js";import"./index.esm-DsVNKcbi.js";import"./index.esm-DYJS1BO8.js";import"./index.esm-CoQrrDhV.js";function ye({dealers:B,addModal:D,setAddModalFooter:T,onHide:S,products:z,csrf_token:I,toast:h,setRecords:q,initialDealer:x=null,dealerOrderPage:n,auth:p}){const[r,o]=i.useState(0),[c,g]=i.useState(null),[a,v]=i.useState([]),[E,A]=i.useState(""),[d,F]=i.useState(!1),[j,u]=i.useState(!1),[w,V]=i.useState([{label:"Bayi Seçimi"},{label:"Ürün Seçimi"},{label:"Adet Girimi"},{label:"Ek Bilgiler"}]);i.useEffect(()=>{(x!==null||n)&&(g(x),o(1))},[x,n]);const C=(t=!1)=>{if(r===0)c==null?u(!0):(u(!1),t&&o(r+1));else if(r===1)a.length>0?(u(!1),t&&o(r+1)):u(!0);else if(r===2){let l=!0;a.forEach(s=>{(s.quantity===null||s.quantity===void 0||s.quantity===0)&&(l=!1)}),l?(u(!1),t&&o(r+1)):u(!0)}},N=i.useRef(null),L=()=>{let t=new FormData;t.append("dealer_id",c.id),t.append("note",N.current.value);let l=a.map(s=>({product_id:s.id,quantity:s.quantity}));t.append("products",JSON.stringify(l)),F(!0),fetch(route("central.orders.store"),{method:"POST",headers:{"X-CSRF-TOKEN":I},body:t}).then(s=>s.json()).then(s=>{s.status?(q(s.orders),h.current.show({severity:"success",summary:"İşlem Başarılı",detail:s.message}),S()):h.current.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{h.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{F(!1)})};i.useEffect(()=>{T(()=>(C(),e.jsxs(e.Fragment,{children:[e.jsx(f,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:S,loading:d}),r!==0&&!(r===1&&n===!0)&&e.jsx(f,{label:"Geri",icon:"pi pi-arrow-left",size:"small",className:"p-button-warning",onClick:()=>o(r-1),loading:d}),r===w.length-1?e.jsx(f,{label:"Kaydet",icon:"pi pi-save",onClick:L,disabled:j,size:"small",className:"p-button-success",loading:d}):e.jsx(f,{label:"İleri",icon:"pi pi-arrow-right",disabled:j,size:"small",className:"p-button-success",onClick:()=>C(!0),loading:d})]})))},[D,r,c,d,j,a]);const M=(t,l)=>{let s=t.value,k=[...a],y={...l};y.quantity=s,y.total=Math.round(s*l.price*100)/100,k[a.indexOf(l)]=y,v(k)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{model:w,onSelect:t=>o(t.index),activeIndex:r,className:"mb-10"}),e.jsxs("div",{children:[r===0&&e.jsx(e.Fragment,{children:e.jsxs(b,{className:"w-full md:w-14rem",children:[e.jsx(G,{value:c,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:t=>g(t.value),options:B,optionLabel:"name",className:"w-full"}),e.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]})}),r===1&&e.jsx(e.Fragment,{children:e.jsxs(b,{className:"w-full",children:[e.jsx($,{panelFooterTemplate:()=>{const t=a?a.length:0;return e.jsxs("div",{className:"py-2 px-3",children:[e.jsx("b",{children:t})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:t=>e.jsxs("span",{children:["#",t.sku," - ",t.name," ",!n&&p.user.role==="super"&&e.jsxs(e.Fragment,{children:["- ",t.price," $"]})]}),value:a,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:t=>v(t.value),options:z,optionLabel:"name",className:"w-full"}),e.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]})}),r===2&&e.jsxs(e.Fragment,{children:[e.jsxs(H,{value:a,showGridlines:!0,children:[e.jsx(m,{field:"id",header:"#ID"}),e.jsx(m,{field:"name",header:"Ürün Adı"}),e.jsx(m,{field:"sku",header:"Ürün Stok kodu"}),!n&&p.user.role==="super"&&e.jsx(m,{field:"price",header:"Ürün Fiyatı"}),e.jsx(m,{header:"Adet",align:"center",body:t=>e.jsx(K,{showButtons:!0,suffix:" Adet",value:t.quantity,onChange:l=>M(l,t)})}),!n&&p.user.role==="super"&&e.jsx(m,{field:"total",header:"Tutar",body:t=>e.jsxs("span",{children:[t.total," $"]})})]}),e.jsx(_,{}),!n&&p.user.role==="super"&&e.jsx("div",{children:e.jsxs("h3",{children:["Toplam Tutar: ",a.reduce((t,l)=>t+l.total,0)," $"]})})]}),r===3&&e.jsx(e.Fragment,{children:e.jsxs(b,{children:[e.jsx(J,{ref:N,id:"order_note",value:E,onChange:t=>A(t.target.value),rows:5,className:"w-full"}),e.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]})})]})]})}export{ye as default};
