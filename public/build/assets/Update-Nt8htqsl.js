import{r,j as t}from"./app-BAn7_dTb.js";import{D as v}from"./dropdown.esm-BtFYSW89.js";import{F as d}from"./floatlabel.esm-Dqe_4BRh.js";import{B as _}from"./button.esm-6ttV0C6_.js";import{M as V}from"./multiselect.esm-Ry0Q08SQ.js";import{D as X}from"./datatable.esm-CXnkpC2s.js";import{C as c}from"./column.esm-BcHguukg.js";import{I as Q}from"./inputnumber.esm-CoAb1Pp-.js";import{I as W}from"./inputtextarea.esm-Dih1XfBG.js";import{I as T}from"./inputtext.esm-Bfdbkh3z.js";import"./ripple.esm-itjK-D4Y.js";import"./index.esm-CCuWUXN6.js";import"./index.esm-BiwjashV.js";import"./index.esm-DTunBSBe.js";import"./overlayservice.esm-DZKaad4z.js";import"./tooltip.esm-wnagnDyJ.js";import"./csstransition.esm-WhQAvYuz.js";import"./index.esm-ChR_tx62.js";import"./index.esm-1RYS9H8v.js";import"./index.esm-Bk2WVbt4.js";import"./paginator.esm-BrSaDBQK.js";import"./index.esm-D7KoaXEa.js";import"./index.esm-CHobkVge.js";import"./index.esm-Cux1oyub.js";import"./index.esm-Cp0J54q5.js";function Ne({dealers:B,addModal:D,record:a,setUpdateModalFooter:z,onHide:k,products:L,csrf_token:I,toast:j,setRecords:K,statuses:O,salesmans:q,dealerOrderPage:Z=!1,dealerPage:E=!1}){const[u,M]=r.useState({id:a.dealer.id,name:a.dealer.name,email:a.dealer.email,phone:a.dealer.phone}),[h,P]=r.useState({id:a.user_id,label:a.user_label}),[f,U]=r.useState(a.tracking_code||""),[g,R]=r.useState(a.tracking_url||""),w=a.products.map(e=>{let l=e.product;return{category:l.category,id:l.id,name:l.name,price:l.price,sku:l.sku,quantity:e.quantity,total:Math.round(e.quantity*l.price*100)/100}}),[i,N]=r.useState(w),[x,C]=r.useState(a.note?a.note:""),[y,F]=r.useState(!1),[A,Y]=r.useState(!1),[m,$]=r.useState(a.status),[b,p]=r.useState(!1);r.useEffect(()=>{let e=!1;if(i.forEach(l=>{a.products.find(n=>n.product_id===l.id)||(e=!0)}),a.products.forEach(l=>{i.find(n=>n.id===l.product_id)||(e=!0)}),(u==null?void 0:u.id)!==a.dealer.id||x!==a.note||m!==a.status||h.id!==a.user_id||f!==a.tracking_code||g!==a.tracking_url||e)p(!0);else{let l=w.reduce((n,o)=>n+o.total,0),s=i.reduce((n,o)=>n+o.total,0);p(l!==s)}Y(!b)},[u,i,x,m,h,f,g,a]);const H=()=>{let e=new FormData;e.append("dealerPage",E),e.append("dealer_id",u.id),e.append("note",x),e.append("status",m),e.append("user_id",h.id),m==="shipping"&&(e.append("tracking_code",f),e.append("tracking_url",g));let l=i.map(s=>({product_id:s.id,quantity:s.quantity}));e.append("products",JSON.stringify(l)),e.append("_method","PUT"),F(!0),fetch(route("super.orders.update",a.id),{method:"POST",headers:{"X-CSRF-TOKEN":I},body:e}).then(s=>s.json()).then(s=>{s.status?(K(s.orders),j.current.show({severity:"success",summary:"İşlem Başarılı",detail:s.message}),k()):j.current.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{j.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{F(!1)})};r.useEffect(()=>{z(()=>t.jsxs(t.Fragment,{children:[t.jsx(_,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:k,loading:y}),t.jsx(_,{label:"Kaydet",icon:"pi pi-save",onClick:H,disabled:!b,size:"small",className:"p-button-success",loading:y})]}))},[D,u,y,A,b]);const G=(e,l)=>{let s=e.value;N(n=>{let o=[...n],S=o.findIndex(J=>J.id===l.id);return o[S].quantity=s,o[S].total=Math.round(s*o[S].price*100)/100,o})};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-10",children:[t.jsxs(d,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{value:u,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:e=>M(e.value),options:B,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]}),t.jsxs(d,{className:"w-full mb-5",children:[t.jsx(V,{panelFooterTemplate:()=>{const e=i?i.length:0;return t.jsxs("div",{className:"py-2 px-3",children:[t.jsx("b",{children:e})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:e=>t.jsxs("span",{children:["#",e.sku," - ",e.name," - ",e.price," $"]}),virtualScrollerOptions:{itemSize:38},value:i,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:e=>N(e.value),options:L,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]}),t.jsxs(X,{value:i,showGridlines:!0,size:"small",className:i.length>0?"mx-auto":"hidden",children:[t.jsx(c,{field:"id",header:"#ID"}),t.jsx(c,{field:"name",header:"Ürün Adı"}),t.jsx(c,{field:"sku",header:"Ürün Stok kodu"}),t.jsx(c,{field:"price",header:"Ürün Fiyatı"}),t.jsx(c,{header:"Adet",align:"center",body:e=>t.jsx(Q,{showButtons:!0,suffix:" Adet",value:e.quantity,onChange:l=>G(l,e)})}),t.jsx(c,{field:"total",header:"Tutar",body:e=>t.jsxs("span",{children:[e.total," $"]})})]}),i.length>0&&t.jsx("div",{className:"my-5",children:t.jsxs("h3",{children:["Toplam Tutar: ",i.reduce((e,l)=>e+l.total,0)," $"]})}),t.jsxs(d,{className:"mb-10",children:[t.jsx(W,{id:"order_note",value:x,onChange:e=>C(e.target.value),rows:5,onKeyDown:e=>{C(e.target.value)},className:"w-full"}),t.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]}),t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(v,{value:m,onChange:e=>$(e.value),options:O,optionLabel:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Sipariş Durumu"})]}),t.jsxs(d,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{emptyFilterMessage:"Yetkili Bulunamadı",value:h,filter:!0,onChange:e=>P(e.value),options:q,optionLabel:"label",filterBy:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Satış Yetkilisi"})]}),m==="shipping"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(T,{value:f,onChange:e=>{U(e.target.value),p(!0)},placeholder:"Kargo takip kodunu giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip Kodu"})]}),t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(T,{value:g,onChange:e=>{R(e.target.value),p(!0)},placeholder:"Kargo takip URL'sini giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip URL (Opsiyonel)"})]})]})]})})}export{Ne as default};
