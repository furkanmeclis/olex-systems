import{r as c,j as e}from"./app-B5hOVfH9.js";import{I as m}from"./inputtext.esm-CjyKDb2H.js";import{B as b}from"./button.esm-C1jYkyJJ.js";import{B as k}from"./blockui.esm-C2SGvxAI.js";import{u as _}from"./formik.esm-B9hlUNfV.js";import{c as B,a as i}from"./index.esm-B2iZkhpi.js";import{M}from"./message.esm-DfscaZOo.js";import{S as j}from"./selectbutton.esm-BOXwK5QO.js";import{B as X}from"./badge.esm-CKGaXPij.js";import{T as q}from"./toast.esm-bsuWSzMT.js";import{D as A}from"./dialog.esm-BZ7r1lVd.js";import{I as D}from"./inputmask.esm-B4ClysfD.js";import{m as N}from"./motion-BOEnrRgn.js";import"./ripple.esm-C8vDKjYa.js";import"./tooltip.esm-C8BHV-dw.js";import"./index.esm-DX9gGFyW.js";import"./cloneDeep-DJN0yfLA.js";import"./index.esm-CF18XLKO.js";import"./index.esm-jCW2sksr.js";import"./index.esm-DHmtDzg1.js";import"./csstransition.esm-BM1qMnOK.js";import"./index.esm-CQM5Aq1Y.js";import"./TransitionGroup-BQ-d_Upr.js";function me({csrf_token:g,setUsers:y,user:s,superPage:w,visible:F,setVisible:d}){const f=c.useRef(null),[p,x]=c.useState(!1),z=c.useMemo(()=>s!=null&&s.notification_settings?Object.entries(JSON.parse(s.notification_settings)).map(([a,n])=>n?a:null).filter(a=>a!==null):[],[s]),u=(a,n,t)=>{f.current.show({severity:a,summary:n,detail:t})},{values:l,handleSubmit:C,submitForm:O,submitCount:S,handleChange:o,dirty:E,setFieldValue:v,errors:r,setErrors:V}=_({initialValues:{type:s.type||"individual",name:s.name,email:s.email,phone:s.phone,image:s.avatar,gender:s.gender,player_id:s.player_id,address:s.address,contact:z,vatName:s.vat_name||"",vatNumber:s.vat_number||"",vatOffice:s.vat_office||""},validationSchema:B().shape({type:i().required("Müşteri tipi seçimi zorunludur"),name:i().required("Müşteri/Firma Adı zorunludur"),email:i().email("Geçerli bir e-posta adresi giriniz").required("E-posta adresi zorunludur"),phone:i().required("Telefon numarası zorunludur"),address:i().required("Adres zorunludur"),vatName:i().when("type",{is:"company",then:()=>i().required("Vergi adı zorunludur"),otherwise:()=>i()}),vatNumber:i().when("type",{is:"company",then:()=>i().required("Vergi numarası zorunludur"),otherwise:()=>i()}),vatOffice:i().when("type",{is:"company",then:()=>i().required("Vergi dairesi zorunludur"),otherwise:()=>i()})}),onSubmit:a=>{x(!0);let n=new FormData;Object.keys(a).forEach(t=>{t==="contact"?n.append("notification_settings",JSON.stringify(a[t])):n.append(t,a[t])}),n.append("_method","PUT"),fetch(route(`${w?"super":"dealer"}.customers.update`,s.id),{method:"POST",headers:{"X-CSRF-TOKEN":g},body:n}).then(t=>t.json()).then(t=>{t.status?(u("success","Başarılı",t.message),setTimeout(()=>{y(t.customers),d(!1)},500)):u("error","Hata",t.message)}).catch(()=>{u("error","Hata","Bir hata oluştu")}).finally(()=>{x(!1)})}}),h=c.useMemo(()=>l.type==="company",[l.type]),T=[{icon:"pi pi-user",value:"individual",label:"Bireysel"},{icon:"pi pi-building",value:"company",label:"Kurumsal"}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{ref:f}),e.jsx(A,{header:`${h?"Kurumsal":"Bireysel"} Müşteri Düzenle`,visible:F,style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>d(!1),maximizable:!0,footer:e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:()=>d(!1),loading:p}),e.jsx(b,{label:"Kaydet",icon:"pi pi-save",size:"small",className:"p-button-success",loading:p,onClick:()=>{O().then(a=>{})}})]}),children:e.jsx(k,{blocked:p,template:e.jsx("i",{className:"pi pi-spin pi-spinner",style:{fontSize:"3rem"}}),children:e.jsxs("form",{className:"p-fluid",onSubmit:C,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 mb-3",children:[e.jsx("div",{className:"col-span-2 grid gap-y-2",children:S>0&&Object.keys(r).length>0&&e.jsx(e.Fragment,{children:Object.entries(r).map(([a,n])=>e.jsx(M,{severity:"warn",text:n},a))})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"font-bold mb-2 block",children:"Müşteri Tipi"}),e.jsx(j,{value:l.type,onChange:a=>v("type",a.value),options:T,itemTemplate:a=>e.jsxs(N.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"flex items-center gap-2 px-4 py-2",children:[e.jsx("i",{className:a.icon}),e.jsx("span",{children:a.label})]}),className:"w-full"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{htmlFor:"name",className:"font-bold",children:[h?"Firma Adı":"Müşteri Adı"," ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(m,{id:"name",name:"name",onChange:o,value:l.name||"",autoFocus:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"email",className:"font-bold",children:["E-posta Adresi ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(m,{id:"email",type:"email",name:"email",onChange:o,value:l.email||""})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"phone",className:"font-bold",children:["Telefon Numarası ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(D,{id:"phone",name:"phone",value:l.phone,onChange:o,mask:"(999) 999-9999",placeholder:"(5XX) XXX-XXXX",className:r.phone?"p-invalid w-full":"w-full"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"address",className:"font-bold",children:["Adres ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(m,{id:"address",type:"text",name:"address",onChange:o,value:l.address||""})]}),h&&e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"field",children:[e.jsxs("label",{htmlFor:"vatName",className:"font-bold block mb-2",children:["Vergi Adı",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"vatName",value:l.vatName,onChange:o,className:r.vatName?"p-invalid w-full":"w-full"}),r.vatName&&e.jsx("small",{className:"p-error",children:r.vatName})]}),e.jsxs("div",{className:"field",children:[e.jsxs("label",{htmlFor:"vatNumber",className:"font-bold block mb-2",children:["Vergi Numarası",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"vatNumber",value:l.vatNumber,onChange:o,className:r.vatNumber?"p-invalid w-full":"w-full"}),r.vatNumber&&e.jsx("small",{className:"p-error",children:r.vatNumber})]}),e.jsxs("div",{className:"field",children:[e.jsxs("label",{htmlFor:"vatOffice",className:"font-bold block mb-2",children:["Vergi Dairesi",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"vatOffice",value:l.vatOffice,onChange:o,className:r.vatOffice?"p-invalid w-full":"w-full"}),r.vatOffice&&e.jsx("small",{className:"p-error",children:r.vatOffice})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"player_id",className:"font-bold",children:"Device ID"}),e.jsx(m,{id:"player_id",type:"text",name:"player_id",onChange:o,value:l.player_id||""})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"font-bold block mb-2",children:"İletişim Tercihleri"}),e.jsx(j,{multiple:!0,value:l.contact,onChange:a=>v("contact",a.value),itemTemplate:a=>{let n=l.contact&&l.contact.includes(a.value);return e.jsx("div",{className:"w-full text-center",children:e.jsx("i",{className:a.icon+" p-overlay-badge",style:{fontSize:"1.5rem"},children:n&&e.jsx(X,{severity:"success",value:e.jsx("i",{className:"pi pi-check"}),style:{fontSize:"1px"}})})})},optionLabel:"value",options:[{icon:"pi pi-envelope",value:"email"},{icon:"pi pi-send",value:"sms"},{icon:"pi pi-bell",value:"push"}]})]})]})})})]})}export{me as default};
