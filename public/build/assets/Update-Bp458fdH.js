import{r,j as t}from"./app-D0mPTlLT.js";import{D as v}from"./dropdown.esm-D7Kr61xS.js";import{F as p}from"./floatlabel.esm-6hLNN44h.js";import{B as _}from"./button.esm-NYPGq0YV.js";import{M as X}from"./multiselect.esm-oDxAUrBK.js";import{D as Q}from"./datatable.esm-Btm2xHuu.js";import{C as m}from"./column.esm-B3a4gCn_.js";import{I as W}from"./inputnumber.esm-CwO-atjI.js";import{I as Z}from"./inputtextarea.esm-DJzaBMoy.js";import{I as T}from"./inputtext.esm-BfiG1az1.js";import"./ripple.esm-Dp2KI1ix.js";import"./index.esm-3kKdjh-j.js";import"./index.esm-CGywSAff.js";import"./index.esm-DGB2Ro_U.js";import"./overlayservice.esm-DhOLZI92.js";import"./tooltip.esm-BL5Tc1BM.js";import"./csstransition.esm-DL5I2jB8.js";import"./index.esm-4KGOykdC.js";import"./index.esm-DZqha3X7.js";import"./index.esm-D1lWgiY_.js";import"./paginator.esm-DimCwoaU.js";import"./index.esm-BlotRP9b.js";import"./index.esm-CsRPPUP8.js";import"./index.esm-FRiiXSZe.js";import"./index.esm-yWbQLgEf.js";function we({dealers:B,addModal:z,record:a,setUpdateModalFooter:D,onHide:N,products:L,csrf_token:I,toast:y,setRecords:q,statuses:E,salesmans:K,auth:f,dealerPage:M=!1}){const[o,O]=r.useState({id:a.dealer.id,name:a.dealer.name,email:a.dealer.email,phone:a.dealer.phone}),[c,P]=r.useState({id:a.user_id,label:a.user_label}),[x,U]=r.useState(a.tracking_code||""),[g,R]=r.useState(a.tracking_url||""),w=a.products.map(e=>{let s=e.product;return{category:s.category,id:s.id,name:s.name,price:s.price,sku:s.sku,quantity:e.quantity,total:Math.round(e.quantity*s.price*100)/100}}),[i,C]=r.useState(w),[j,A]=r.useState(a.note?a.note:""),[b,F]=r.useState(!1),[Y,$]=r.useState(!1),[d,H]=r.useState(a.status),[S,h]=r.useState(!1);r.useEffect(()=>{let e=!1;if(i.forEach(s=>{a.products.find(n=>n.product_id===s.id)||(e=!0)}),a.products.forEach(s=>{i.find(n=>n.id===s.product_id)||(e=!0)}),(o==null?void 0:o.id)!==a.dealer.id||j!==a.note||d!==a.status||c.id!==a.user_id||x!==a.tracking_code||g!==a.tracking_url||e)h(!0);else{let s=w.reduce((n,u)=>n+u.total,0),l=i.reduce((n,u)=>n+u.total,0);h(s!==l)}$(!S)},[o,i,j,d,c,x,g,a]);const G=()=>{let e=new FormData;e.append("dealerPage",M),e.append("dealer_id",o.id),e.append("note",j),e.append("status",d),e.append("user_id",c.id),d==="shipping"&&(e.append("tracking_code",x),e.append("tracking_url",g));let s=i.map(l=>({product_id:l.id,quantity:l.quantity}));e.append("products",JSON.stringify(s)),e.append("_method","PUT"),e.append("status",d),e.append("user_id",c.id),F(!0),fetch(route("central.orders.update",a.id),{method:"POST",headers:{"X-CSRF-TOKEN":I},body:e}).then(l=>l.json()).then(l=>{l.status?(q(l.orders),y.current.show({severity:"success",summary:"İşlem Başarılı",detail:l.message}),N()):y.current.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{y.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{F(!1)})};r.useEffect(()=>{D(()=>t.jsxs(t.Fragment,{children:[t.jsx(_,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:N,loading:b}),t.jsx(_,{label:"Kaydet",icon:"pi pi-save",onClick:G,disabled:!S,size:"small",className:"p-button-success",loading:b})]}))},[z,o,b,Y,S]);const J=(e,s)=>{let l=e.value;C(n=>{let u=[...n],k=u.findIndex(V=>V.id===s.id);return u[k].quantity=l,u[k].total=Math.round(l*u[k].price*100)/100,u})};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-10",children:[t.jsxs(p,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{value:o,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:e=>O(e.value),options:B,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]}),t.jsxs(p,{className:"w-full mb-5",children:[t.jsx(X,{panelFooterTemplate:()=>{const e=i?i.length:0;return t.jsxs("div",{className:"py-2 px-3",children:[t.jsx("b",{children:e})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:e=>t.jsxs("span",{children:["#",e.sku," - ",e.name," - ",f.user.role==="super"&&t.jsxs(t.Fragment,{children:["- ",e.price," $"]})]}),virtualScrollerOptions:{itemSize:38},value:i,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:e=>C(e.value),options:L,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]}),t.jsxs(Q,{value:i,showGridlines:!0,size:"small",className:i.length>0?"mx-auto":"hidden",children:[t.jsx(m,{field:"id",header:"#ID"}),t.jsx(m,{field:"name",header:"Ürün Adı"}),t.jsx(m,{field:"sku",header:"Ürün Stok kodu"}),f.user.role==="super"&&t.jsx(m,{field:"price",header:"Ürün Fiyatı"}),t.jsx(m,{header:"Adet",align:"center",body:e=>t.jsx(W,{showButtons:!0,suffix:" Adet",value:e.quantity,onChange:s=>J(s,e)})}),f.user.role==="super"&&t.jsx(m,{field:"total",header:"Tutar",body:e=>t.jsxs("span",{children:[e.total," $"]})})]}),i.length>0&&f.user.role==="super"&&t.jsx("div",{className:"my-5",children:t.jsxs("h3",{children:["Toplam Tutar: ",i.reduce((e,s)=>e+s.total,0)," $"]})}),t.jsxs(p,{className:"mb-10",children:[t.jsx(Z,{id:"order_note",value:j,onChange:e=>A(e.target.value),rows:5,className:"w-full"}),t.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]}),t.jsxs(p,{className:"w-full mb-10",children:[t.jsx(v,{value:d,onChange:e=>H(e.value),options:E,optionLabel:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Sipariş Durumu"})]}),t.jsxs(p,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{emptyFilterMessage:"Yetkili Bulunamadı",value:c,filter:!0,onChange:e=>P(e.value),options:K,optionLabel:"label",filterBy:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Satış Yetkilisi"})]}),d==="shipping"&&t.jsxs(t.Fragment,{children:[t.jsxs(p,{className:"w-full mb-10",children:[t.jsx(T,{value:x,onChange:e=>{U(e.target.value),h(!0)},placeholder:"Kargo takip kodunu giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip Kodu"})]}),t.jsxs(p,{className:"w-full mb-10",children:[t.jsx(T,{value:g,onChange:e=>{R(e.target.value),h(!0)},placeholder:"Kargo takip URL'sini giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip URL (Opsiyonel)"})]})]})]})})}export{we as default};
