import{r,j as t}from"./app-CbKgTnfw.js";import{D as v}from"./dropdown.esm-5OCrWUkh.js";import{F as m}from"./floatlabel.esm-BqTxcGem.js";import{B as _}from"./button.esm-D0GGsqfP.js";import{M as V}from"./multiselect.esm-fUmmJntJ.js";import{D as X}from"./datatable.esm-bq0OClDD.js";import{C as p}from"./column.esm-iXUglLdf.js";import{I as Q}from"./inputnumber.esm-B3C6OAA_.js";import{I as W}from"./inputtextarea.esm-CjoJ30PW.js";import{I as T}from"./inputtext.esm-BCUyyFJJ.js";import"./ripple.esm-Bz0HPTmf.js";import"./index.esm-gqha0LF7.js";import"./index.esm-CZj6-l6V.js";import"./index.esm-CBE3UGX1.js";import"./overlayservice.esm-0pIkdLm4.js";import"./tooltip.esm-B0Fxn3I7.js";import"./csstransition.esm-CEurPmtU.js";import"./index.esm-CxG-i5f8.js";import"./index.esm-BwStUmvm.js";import"./index.esm-B9INqRdX.js";import"./paginator.esm--_xCwVYF.js";import"./index.esm-BHYNhjBT.js";import"./index.esm-jqxCJFL2.js";import"./index.esm-C6_txXFL.js";import"./index.esm-CoNLEXO0.js";function Ne({dealers:B,addModal:z,record:a,setUpdateModalFooter:D,onHide:N,products:L,csrf_token:I,toast:y,setRecords:q,statuses:E,salesmans:K,auth:f}){const[o,M]=r.useState({id:a.dealer.id,name:a.dealer.name,email:a.dealer.email,phone:a.dealer.phone}),[c,O]=r.useState({id:a.user_id,label:a.user_label}),[x,U]=r.useState(a.tracking_code||""),[g,P]=r.useState(a.tracking_url||""),w=a.products.map(e=>{let s=e.product;return{category:s.category,id:s.id,name:s.name,price:s.price,sku:s.sku,quantity:e.quantity,total:Math.round(e.quantity*s.price*100)/100}}),[i,C]=r.useState(w),[j,R]=r.useState(a.note?a.note:""),[b,F]=r.useState(!1),[A,Y]=r.useState(!1),[d,$]=r.useState(a.status),[S,h]=r.useState(!1);r.useEffect(()=>{let e=!1;if(i.forEach(s=>{a.products.find(n=>n.product_id===s.id)||(e=!0)}),a.products.forEach(s=>{i.find(n=>n.id===s.product_id)||(e=!0)}),(o==null?void 0:o.id)!==a.dealer.id||j!==a.note||d!==a.status||c.id!==a.user_id||x!==a.tracking_code||g!==a.tracking_url||e)h(!0);else{let s=w.reduce((n,u)=>n+u.total,0),l=i.reduce((n,u)=>n+u.total,0);h(s!==l)}Y(!S)},[o,i,j,d,c,x,g,a]);const H=()=>{let e=new FormData;e.append("dealer_id",o.id),e.append("note",j),e.append("status",d),e.append("user_id",c.id),d==="shipping"&&(e.append("tracking_code",x),e.append("tracking_url",g));let s=i.map(l=>({product_id:l.id,quantity:l.quantity}));e.append("products",JSON.stringify(s)),e.append("_method","PUT"),e.append("status",d),e.append("user_id",c.id),F(!0),fetch(route("central.orders.update",a.id),{method:"POST",headers:{"X-CSRF-TOKEN":I},body:e}).then(l=>l.json()).then(l=>{l.status?(q(l.orders),y.current.show({severity:"success",summary:"İşlem Başarılı",detail:l.message}),N()):y.current.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{y.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{F(!1)})};r.useEffect(()=>{D(()=>t.jsxs(t.Fragment,{children:[t.jsx(_,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:N,loading:b}),t.jsx(_,{label:"Kaydet",icon:"pi pi-save",onClick:H,disabled:!S,size:"small",className:"p-button-success",loading:b})]}))},[z,o,b,A,S]);const G=(e,s)=>{let l=e.value;C(n=>{let u=[...n],k=u.findIndex(J=>J.id===s.id);return u[k].quantity=l,u[k].total=Math.round(l*u[k].price*100)/100,u})};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-10",children:[t.jsxs(m,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{value:o,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:e=>M(e.value),options:B,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]}),t.jsxs(m,{className:"w-full mb-5",children:[t.jsx(V,{panelFooterTemplate:()=>{const e=i?i.length:0;return t.jsxs("div",{className:"py-2 px-3",children:[t.jsx("b",{children:e})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:e=>t.jsxs("span",{children:["#",e.sku," - ",e.name," - ",f.user.role==="super"&&t.jsxs(t.Fragment,{children:["- ",e.price," $"]})]}),virtualScrollerOptions:{itemSize:38},value:i,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:e=>C(e.value),options:L,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]}),t.jsxs(X,{value:i,showGridlines:!0,size:"small",className:i.length>0?"mx-auto":"hidden",children:[t.jsx(p,{field:"id",header:"#ID"}),t.jsx(p,{field:"name",header:"Ürün Adı"}),t.jsx(p,{field:"sku",header:"Ürün Stok kodu"}),f.user.role==="super"&&t.jsx(p,{field:"price",header:"Ürün Fiyatı"}),t.jsx(p,{header:"Adet",align:"center",body:e=>t.jsx(Q,{showButtons:!0,suffix:" Adet",value:e.quantity,onChange:s=>G(s,e)})}),f.user.role==="super"&&t.jsx(p,{field:"total",header:"Tutar",body:e=>t.jsxs("span",{children:[e.total," $"]})})]}),i.length>0&&f.user.role==="super"&&t.jsx("div",{className:"my-5",children:t.jsxs("h3",{children:["Toplam Tutar: ",i.reduce((e,s)=>e+s.total,0)," $"]})}),t.jsxs(m,{className:"mb-10",children:[t.jsx(W,{id:"order_note",value:j,onChange:e=>R(e.target.value),rows:5,className:"w-full"}),t.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]}),t.jsxs(m,{className:"w-full mb-10",children:[t.jsx(v,{value:d,onChange:e=>$(e.value),options:E,optionLabel:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Sipariş Durumu"})]}),t.jsxs(m,{className:"w-full md:w-14rem mb-10",children:[t.jsx(v,{emptyFilterMessage:"Yetkili Bulunamadı",value:c,filter:!0,onChange:e=>O(e.value),options:K,optionLabel:"label",filterBy:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Satış Yetkilisi"})]}),d==="shipping"&&t.jsxs(t.Fragment,{children:[t.jsxs(m,{className:"w-full mb-10",children:[t.jsx(T,{value:x,onChange:e=>{U(e.target.value),h(!0)},placeholder:"Kargo takip kodunu giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip Kodu"})]}),t.jsxs(m,{className:"w-full mb-10",children:[t.jsx(T,{value:g,onChange:e=>{P(e.target.value),h(!0)},placeholder:"Kargo takip URL'sini giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip URL (Opsiyonel)"})]})]})]})})}export{Ne as default};
