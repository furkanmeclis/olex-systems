import{j as e,r as i,F as Pe,S as Be,A as Ie}from"./app-CbKgTnfw.js";import{A as Ye}from"./AuthenticatedLayout-D7hTcrJF.js";import{D as Ue}from"./datatable.esm-bq0OClDD.js";import{C as m}from"./column.esm-iXUglLdf.js";import{I as D}from"./inputtext.esm-BCUyyFJJ.js";import{B as o}from"./button.esm-D0GGsqfP.js";import{T as Ge}from"./tooltip.esm-B0Fxn3I7.js";import{C as Xe,c as te}from"./confirmpopup.esm-SoCxuE9m.js";import{T as $e}from"./toolbar.esm-BaPb24vt.js";import{D as w}from"./dialog.esm-CXrc4WLu.js";import{T as Ve}from"./toast.esm-B48oQ1WT.js";import{T as qe}from"./tag.esm-DQ-1fL-l.js";import{D as Je}from"./dropdown.esm-5OCrWUkh.js";import{C as Qe}from"./checkbox.esm-CFHcqNZt.js";import{O as se}from"./overlaypanel.esm-Dsl79LT3.js";import We from"./Create-C-av0qS_.js";import Ze from"./Update-DPgP-GmT.js";import{I as et}from"./image.esm-BTulW83z.js";import{D as tt}from"./divider.esm-DQQk32ZZ.js";import st from"./ProductCodes-B38_tYuI.js";import"./Dropdown-DhhpULLs.js";import"./motion-CjuD6rJ4.js";import"./ripple.esm-Bz0HPTmf.js";import"./index.esm-CZj6-l6V.js";import"./paginator.esm--_xCwVYF.js";import"./inputnumber.esm-B3C6OAA_.js";import"./index.esm-BHYNhjBT.js";import"./index.esm-jqxCJFL2.js";import"./index.esm-BwStUmvm.js";import"./index.esm-gqha0LF7.js";import"./index.esm-C6_txXFL.js";import"./index.esm-CBE3UGX1.js";import"./overlayservice.esm-0pIkdLm4.js";import"./csstransition.esm-CEurPmtU.js";import"./index.esm-CoNLEXO0.js";import"./index.esm-ChhSC-WG.js";import"./index.esm-B9INqRdX.js";import"./index.esm-CxG-i5f8.js";import"./steps.esm-t72S1TpX.js";import"./floatlabel.esm-BqTxcGem.js";import"./multiselect.esm-fUmmJntJ.js";import"./inputtextarea.esm-CjoJ30PW.js";import"./index.esm-BMHdSSxB.js";import"./treetable.esm-C8OtY07G.js";import"./index.esm-jOJsK1hp.js";import"./formik.esm-BqxXn9R1.js";import"./cloneDeep-DJN0yfLA.js";function Jt({auth:j,ordersAll:ie,csrf_token:p,statuses:N,salesmans:ae,dealerPage:z=!1,dealerOrderPage:d=!1}){const E=()=>{const l=i.useRef(null),_=i.useRef(null),[L,re]=i.useState({global:{value:null,matchMode:Pe.CONTAINS}}),[le,g]=i.useState(!1),[A,oe]=i.useState(""),[P,h]=i.useState(ie),[B,ne]=i.useState([]),[I,ce]=i.useState([]),[de,ue]=i.useState(null);i.useState([]);const[u,Y]=i.useState(!1),[pe,me]=i.useState([]),[he,fe]=i.useState(""),[xe,b]=i.useState(!1),[U,S]=i.useState(null),G=i.useRef(null),X=[{field:"id",header:"ID",default:!0},{field:"dealer",header:"Bayi",default:!0},{field:"user",header:"Yetkili",default:!0},{field:"status",header:"Durumu",default:!0},{field:"products_count",header:"Ürün Adedi",default:!0},{field:"price",header:"Sipariş Tutarı",default:!0},{field:"tracking_code",header:"Kargo Takip Kodu",default:!0},{field:"created_at",header:"Eklenme Tarihi",default:!1},{field:"updated_at",header:"Güncellenme Tarihi",default:!1},{field:"actions",header:"İşlemler",default:!0}],[c,ge]=i.useState(localStorage.getItem("selectedColumnsForOrdersTable")?JSON.parse(localStorage.getItem("selectedColumnsForOrdersTable")):X),ye={id:"ID",price:"Sipariş Tutarı",dealer:"Bayi",user:"Yetkili",status:"Durumu",products_count:"Ürün Adedi",updated_at:"Güncellenme Tarihi",created_at:"Eklenme Tarihi",actions:"İşlemler"},je=()=>{g(!0),fetch(route("central.dealers.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p}}).then(t=>t.json()).then(t=>{ne(t.dealers)}).catch(t=>{console.log(t),l.current.show({severity:"error",summary:"Hata",detail:"Bayiler getirilirken bir hata oluştu."})}).finally(()=>{g(!1)})},ve=()=>{g(!0),fetch(route("central.products.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p}}).then(t=>t.json()).then(t=>{ce(t.products.map(s=>(s.total=s.price,s.quantity=1,s)))}).catch(t=>{console.log(t),l.current.show({severity:"error",summary:"Hata",detail:"Ürünler getirilirken bir hata oluştu."})}).finally(()=>{g(!1)})},ke=()=>{g(!0),fetch(route("central.orders.trashAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p}}).then(t=>t.json()).then(t=>{me(P),h(t.records),Y(!0)}).catch(t=>{console.log(t),l.current.show({severity:"error",summary:"Hata",detail:"Çöp sepetindeki siparişler getirilirken bir hata oluştu."})}).finally(()=>{g(!1)})};i.useEffect(()=>{je(),ve()},[]),i.useEffect(()=>{localStorage.setItem("selectedColumnsForOrdersTable",JSON.stringify(c))},[c]);const $=(t,s=!1)=>{const a=s?t:t.target.value;let r={...L};r.global.value=a,re(r),oe(a)},[V,K]=i.useState(!1),[q,R]=i.useState(!1),[J,H]=i.useState(!1),[Q,be]=i.useState(!1),[Se,Ce]=i.useState(!1),[Te,we]=i.useState(e.jsx(e.Fragment,{})),[Ne,Fe]=i.useState(e.jsx(e.Fragment,{})),[v,C]=i.useState([]),[W,M]=i.useState(!1),[ze,_e]=i.useState([]),[Ke,Re]=i.useState(e.jsx(e.Fragment,{})),He=t=>{M(!0),_e(t)},Me=()=>e.jsx(e.Fragment,{children:e.jsx($e,{start:()=>e.jsxs(e.Fragment,{children:[!z&&e.jsx(o,{icon:"pi pi-plus",size:"small",severity:"success",tooltip:"Yeni Sipariş Ekle",tooltipOptions:{position:"top"},onClick:()=>{K(!0)},className:"mr-2"}),e.jsx(o,{icon:"pi pi-bars",size:"small",severity:"info",tooltip:"Kolonları Yönet",tooltipOptions:{position:"top"},onClick:t=>{_.current.toggle(t)},className:"mr-2"}),!z&&!d&&e.jsx(o,{icon:u?"pi pi-folder-open":"pi pi-trash",size:"small",severity:"help",tooltip:u?"Çöp Sepetini Kapat":"Çöp Sepetini Görüntüle",tooltipOptions:{position:"top"},onClick:t=>{u?(h(pe),Y(!1)):ke()},className:"mr-2"}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"small",icon:"pi pi-times",className:"p-button-warning mr-2",onClick:()=>C([]),tooltip:"Seçimi Temizle",tooltipOptions:{position:"top"}}),e.jsx(o,{size:"small",onClick:t=>{te({target:t.currentTarget,message:u?`Seçilen ${C.length} siparişi geri yüklemek istediğinize emin misiniz?`:`Seçilen ${C.length} siparişi silmek istediğinize emin misiniz?`,icon:"pi pi-exclamation-triangle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>{let s=u?route("central.orders.restore"):route("central.orders.multipleDestroy");fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({recordIds:v.map(a=>a.id)})}).then(async a=>{let r=await a.json();a.status===404?l.current.show({severity:"error",summary:"Hata",detail:r.message}):a.status===500?l.current.show({severity:"warning",summary:"Hata",detail:r.message}):a.status===200&&(l.current.show({severity:"success",summary:"Başarılı",detail:r.message}),h(r.records))}).catch(a=>{l.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{C([])})},acceptLabel:u?"Geri Yükle":"Sil",rejectLabel:"Vazgeç"})},icon:u?"pi pi-sync":"pi pi-trash",className:u?"p-button-success mr-2":"p-button-danger mr-2",tooltip:u?`Seçilen ${v.length} siparişi geri yükle`:`Seçilen ${v.length} siparişi Sil`,tooltipOptions:{position:"top"}})]})]}),center:()=>e.jsx(e.Fragment,{children:e.jsxs("p",{className:"flex flex-col items-center justify-center",children:[u&&e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Çöp Sepeti"}),v.length>0&&e.jsxs("span",{children:[v.length," sipariş seçildi."]})]})}),end:()=>e.jsx(e.Fragment,{children:!u&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"p-input-icon-left",children:[e.jsx("i",{className:"pi pi-search"}),e.jsx(D,{size:"small",value:A,onChange:$,placeholder:"Siparişlerde Arama Yapın"})]}),A!==""&&e.jsx(o,{size:"small",icon:"pi pi-times",className:"p-button-info ml-2",onClick:()=>$("",!0),tooltip:"Filtreyi Temizle",tooltipOptions:{position:"top"}})]})})})}),Oe=t=>e.jsx(qe,{value:t.status_label,severity:t.status_severity}),De=Me(),Ee=t=>{R(!0),Ce(t)},Le=t=>{let s=t.newRowData,a=t.rowData,r=t.rowIndex,f=new FormData;f.append("status",s.status),f.append("_method","PUT"),s.status!==a.status&&(g(!0),fetch(route("central.orders.statusUpdate",s.id),{method:"POST",headers:{"X-CSRF-TOKEN":p},body:f}).then(n=>n.json()).then(n=>{n.status?(n==null?void 0:n.dirty)!==!1&&(h(O=>{let x=[...O];return x[r].status_severity=N.find(T=>T.value===s.status).severity,x[r].status_label=N.find(T=>T.value===s.status).label,x[r].status=s.status,x[r].updated_at=n.updated_at,x}),l.current.show({severity:"success",summary:"İşlem Başarılı",detail:n.message})):l.current.show({severity:"error",summary:"Hata",detail:n.message})}).catch(n=>{l.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{g(!1)}))},Z=({record:t,toast:s,csrf_token:a,setRecords:r,isModal:f=!1})=>{const[n,O]=i.useState(t.tracking_code||""),[x,T]=i.useState(t.tracking_url||""),[F,ee]=i.useState(!1),Ae=()=>{if(n===""){s.current.show({severity:"warn",summary:"Hata",detail:"Kargo Takip Kodu Boş Olamaz."});return}if(n===t.tracking_code&&x===t.tracking_url){s.current.show({severity:"info",summary:"Bilgi",detail:"Kargo Takip Bilgileri Güncellenmedi. Değişiklik Yok."});return}ee(!0);let y=new FormData;y.append("tracking_code",n),y.append("tracking_url",x),y.append("_method","PUT"),fetch(route("central.orders.updateTrackingCode",t.id),{method:"POST",headers:{"X-CSRF-TOKEN":a},body:y}).then(k=>k.json()).then(k=>{k.status?(s.current.show({severity:"success",summary:"Başarılı",detail:k.message}),r(k.records)):s.current.show({severity:"error",summary:"Hata",detail:k.message})}).catch(k=>{s.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{ee(!1)})};return f?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"trackingCode",className:"font-medium",children:"Kargo Takip Kodu"}),e.jsx(D,{id:"trackingCode",value:n,onChange:y=>O(y.target.value),placeholder:"Kargo takip kodunu giriniz",disabled:F,className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"trackingUrl",className:"font-medium",children:"Kargo Takip URL (Opsiyonel)"}),e.jsx(D,{id:"trackingUrl",value:x,onChange:y=>T(y.target.value),placeholder:"Kargo takip URL'sini giriniz",disabled:F,className:"w-full"})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(o,{label:"Kaydet",icon:"pi pi-check",onClick:Ae,severity:"success",size:"small",loading:F}),e.jsx(o,{label:"Vazgeç",icon:"pi pi-times",onClick:()=>{S(null),b(!1)},severity:"secondary",size:"small",disabled:F})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"pi pi-truck",text:!0,severity:"secondary",onClick:()=>{S(t),b(!0)},tooltip:"Kargo Takip Bilgilerini Gir",tooltipOptions:{position:"top"},className:"hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-150"}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Kargo takip bilgisi girilmemiş"})]})};return e.jsxs(e.Fragment,{children:[e.jsx(Be,{title:"Siparişler"}),e.jsx(Ge,{target:".custom-target-icon"}),e.jsx(Xe,{}),e.jsx(Ve,{ref:l}),e.jsx(se,{ref:_,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{children:"Kolonları Yönet"})}),e.jsxs("div",{className:"flex flex-col",children:[X.map((t,s)=>e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx(Qe,{inputId:t,checked:c.includes(t),onChange:a=>{let r=[...c];a.checked?r.push(t):r=r.filter(f=>f!==t),ge(r)}}),e.jsx("label",{htmlFor:t,className:"ml-2",children:ye[t]})]},s)),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(o,{label:"Kaydet",severity:"success",size:"small",onClick:()=>{_.current.hide()}})})]})]})}),e.jsx(se,{ref:G,showCloseIcon:!0,closeOnEscape:!0,children:e.jsx("p",{children:he})}),e.jsxs(Ue,{editMode:"cell",dragSelection:!0,value:P,removableSort:!0,paginator:!0,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,filters:L,loading:le,globalFilterFields:[],selectionMode:"checkbox",selection:v,onSelectionChange:t=>{d||C(t.value)},header:De,rowClassName:t=>t.deleted_at!==null?"blur-[.8px] hover:blur-none  ease-in duration-300":"",emptyMessage:"Sipariş bulunamadı.",rowHover:!0,dataKey:"id",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:[!d&&e.jsx(m,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),c.includes("id")&&e.jsx(m,{field:"id",header:"ID",sortable:!0}),c.includes("dealer")&&e.jsx(m,{field:"dealer.name",align:"center",body:t=>e.jsx(o,{link:!0,size:"small",label:t.dealer.name,onClick:()=>{d||Ie.visit(route("central.dealers.show",t.dealer.id))}}),sortable:!0,header:"Bayi Adı"}),c.includes("user")&&e.jsx(m,{field:"user.name",sortable:!0,header:"Yetkili"}),c.includes("status")&&e.jsx(m,{field:"status",header:"Durumu",body:Oe,editor:u||d===!0?null:t=>(ue(t.rowData.status),e.jsx(e.Fragment,{children:e.jsx(Je,{value:de,onChange:s=>t.editorCallback(s.value),options:N,optionLabel:"label",className:"w-full"})})),onCellEditComplete:Le}),c.includes("products_count")&&e.jsx(m,{field:"products_count",body:t=>e.jsx(o,{link:!0,onClick:()=>{t.products_count===0?l.current.show({severity:"info",summary:"Bilgi",detail:"Siparişte ürün bulunmamaktadır."}):(H(!0),be(t.products))},tooltip:"Detayları Görmek İçin Tıklayınız.",label:t.products_count+" Adet",size:"small"}),sortable:!0,header:"Ürün Adedi"}),c.includes("price")&&j.user.role==="super"&&e.jsx(m,{field:"price",header:"Sipariş Tutarı",body:t=>Number(t.products.reduce((s,a)=>s+a.price,0)).toFixed(2)+" $",sortable:!0}),c.includes("tracking_code")&&e.jsx(m,{field:"tracking_code",header:"Kargo Takip",sortable:!0,body:t=>t.status==="shipping"?t.tracking_code?e.jsxs("div",{className:"flex items-center gap-2",children:[t.tracking_url?e.jsxs("a",{href:t.tracking_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 flex items-center gap-1",children:[e.jsx("i",{className:"pi pi-external-link"}),t.tracking_code]}):e.jsx("span",{children:t.tracking_code}),e.jsx(o,{icon:"pi pi-pencil",text:!0,severity:"secondary",size:"small",onClick:()=>{S(t),b(!0)}})]}):e.jsx(Z,{record:t,toast:l,csrf_token:p,setRecords:h}):e.jsx("span",{className:"text-gray-500",children:"-"})}),c.includes("created_at")&&e.jsx(m,{field:"created_at",sortable:!0,header:"Eklenme Tarihi",body:t=>new Date(t.created_at).toLocaleString()}),c.includes("updated_at")&&e.jsx(m,{field:"updated_at",sortable:!0,header:"Güncellenme Tarihi",body:t=>new Date(t.updated_at).toLocaleString()}),c.includes("actions")&&!u&&!d&&e.jsx(m,{field:"actions",header:"İşlemler",body:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center gap-x-2",children:[e.jsx(o,{icon:"pi pi-book",size:"small",tooltip:"Sipariş Notu",visible:t.note!=="",onClick:s=>{fe(t.note),G.current.toggle(s)},tooltipOptions:{position:"top"},severity:"help"}),e.jsx(o,{icon:"pi pi-qrcode",size:"small",tooltip:"Ürün Kodları",onClick:()=>{He(t)},tooltipOptions:{position:"top"},severity:"success"}),!d&&e.jsx(o,{icon:"pi pi-pencil",size:"small",tooltip:"Siparişi Düzenle",onClick:()=>{Ee(t)},tooltipOptions:{position:"top"},severity:"warning"}),!d&&e.jsx(o,{icon:"pi pi-times",tooltip:"Siparişi Sil",tooltipOptions:{position:"top"},size:"small",onClick:s=>{te({target:s.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",accept:()=>{fetch(route("central.orders.destroy",t.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p}}).then(async a=>{let r=await a.json();a.status===404?l.current.show({severity:"error",summary:"Hata",detail:r.message}):a.status===500?l.current.show({severity:"warning",summary:"Hata",detail:r.message}):a.status===200&&(l.current.show({severity:"success",summary:"Başarılı",detail:r.message}),h(f=>f.filter(n=>n.id!==t.id)))}).catch(a=>{l.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})})},acceptLabel:"Sil",rejectLabel:"Vazgeç"})},severity:"danger"})]})})})]}),e.jsx(w,{header:"Yeni Sipariş Ekle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>K(!1),maximizable:!0,visible:V,footer:Te,children:e.jsx(We,{addModal:V,csrf_token:p,dealers:B,products:I,toast:l,auth:j,initialDealer:d?j.user:null,dealerOrderPage:d,onHide:()=>K(!1),setRecords:h,setAddModalFooter:we})}),e.jsx(w,{header:"Ürünler",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>H(!1),maximizable:!0,visible:J,footer:()=>e.jsx(o,{label:"Kapat",onClick:()=>H(!1),severity:"warning",size:"small"}),children:J&&e.jsxs("div",{className:"card flex flex-col",children:[Q.map(t=>{let s=t.product;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx(et,{className:"w-[4rem] shadow-2 flex-shrink-0 border-round",preview:!0,src:s.image,alt:s.name}),e.jsxs("span",{className:"font-bold flex-1",children:[t.quantity," Adet - ",s.name," (#",s.sku,")"]}),j.user.role==="super"&&e.jsxs("span",{className:"font-bold text-900",children:["$ ",t.price]})]}),e.jsx(tt,{})]})}),j.user.role==="super"&&e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx("span",{className:"font-bold flex-1",children:"Toplam"}),e.jsxs("span",{className:"font-bold text-900",children:["$ ",Q.reduce((t,s)=>t+s.price,0)]})]})]})}),!d&&e.jsx(w,{header:"Siparişi Düzenle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>R(!1),maximizable:!0,visible:q,footer:Ne,children:e.jsx(Ze,{updateModal:q,salesmans:ae,statuses:N,dealerOrderPage:d,csrf_token:p,auth:j,dealers:B,products:I,record:Se,toast:l,onHide:()=>R(!1),setRecords:h,setUpdateModalFooter:Fe})}),e.jsx(w,{header:"Ürün Kodları",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>M(!1),maximizable:!0,visible:W,footer:Ke,children:e.jsx(st,{productCodesModal:W,order:ze,setRecords:h,csrf_token:p,toast:l,onHide:()=>M(!1),setFooter:Re})}),e.jsx(w,{header:"Kargo Takip Bilgileri",visible:xe,style:{width:"30vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>{b(!1),S(null)},children:U&&e.jsx(Z,{record:U,toast:l,csrf_token:p,setRecords:t=>{h(t),b(!1),S(null)},isModal:!0})})]})};return z||d?e.jsx(E,{}):e.jsx(Ye,{user:j.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Siparişler"}),children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx(E,{})})})})})}export{Jt as default};
