import{j as e,r,F as ke,S as Te,A as Ne}from"./app-B5Ro1tF2.js";import{A as Fe}from"./AuthenticatedLayout-CvibJuqE.js";import{D as ze}from"./datatable.esm-DjPMBA_L.js";import{C as p}from"./column.esm-B-alt3ap.js";import{B as c}from"./button.esm-CRs9G-w5.js";import{T as Me}from"./tooltip.esm-CeL4iahc.js";import{C as De,c as B}from"./confirmpopup.esm-C7sNsHkH.js";import{T as Re}from"./toolbar.esm-BFKTk765.js";import{D as b}from"./dialog.esm-ChdUybZA.js";import{T as He}from"./toast.esm-BXCw23ib.js";import{T as Ee}from"./tag.esm-BG8Dv4Ov.js";import{D as Y}from"./dropdown.esm-seNYrKQj.js";import{C as Oe}from"./checkbox.esm-DjSvGxd_.js";import{O as X}from"./overlaypanel.esm-D4aUgCY4.js";import Ae from"./Create-CNaUtPMY.js";import Le from"./Update-BKmpahZF.js";import{I as Pe}from"./image.esm-CO10kwtY.js";import{D as _e}from"./divider.esm-DNw7c5Fc.js";import Ie from"./ProductCodes-BruFyMvK.js";import"./ApplicationLogo-P0EXx_8w.js";import"./Dropdown-CokIjaSa.js";import"./transition-DgzLvjhv.js";import"./ripple.esm-Bq3XBY3O.js";import"./index.esm-DUycn8Q2.js";import"./paginator.esm-CMo_5vQD.js";import"./inputnumber.esm-Cbm5_WSS.js";import"./inputtext.esm-B5o3MFH4.js";import"./index.esm-CDa3KtzU.js";import"./index.esm-DYRFb8nN.js";import"./index.esm-CaGUm6WG.js";import"./index.esm-DaAXNlej.js";import"./index.esm-CUKl9ULb.js";import"./index.esm-0iHr0KMk.js";import"./overlayservice.esm-Dq_X-Npo.js";import"./csstransition.esm-D0I1w4pY.js";import"./index.esm-KzB7CSJj.js";import"./index.esm-DsY_hiQH.js";import"./index.esm-BSe9B3Sy.js";import"./index.esm-kcPQw2ng.js";import"./steps.esm-DZDGMHDH.js";import"./floatlabel.esm-D4jCMiGi.js";import"./multiselect.esm-BryjQREv.js";import"./inputtextarea.esm-BRn0SIPs.js";import"./index.esm-W1hrzPAw.js";import"./treetable.esm-CcU-NVG4.js";import"./index.esm-CHvTcrvE.js";import"./formik.esm-B1sO77PR.js";import"./cloneDeep-DJN0yfLA.js";function Ot({auth:j,ordersAll:G,csrf_token:m,statuses:g,salesmans:$,dealerPage:w=!1,dealerOrderPage:l=!1}){const M=()=>{const i=r.useRef(null),C=r.useRef(null);r.useState({global:{value:null,matchMode:ke.CONTAINS}});const[U,f]=r.useState(!1);r.useState("");const[D,h]=r.useState([]),[R,q]=r.useState([]),[H,J]=r.useState([]),[V,Q]=r.useState(null);r.useState([]);const[d,E]=r.useState(!1),[W,Z]=r.useState([]),[ee,te]=r.useState(""),O=r.useRef(null),A=["id","dealer","user","status","products_count","price","created_at","updated_at","actions"],[n,se]=r.useState(localStorage.getItem("selectedColumnsForOrdersTable")?JSON.parse(localStorage.getItem("selectedColumnsForOrdersTable")):A),re={id:"ID",price:"Sipariş Tutarı",dealer:"Bayi",user:"Yetkili",status:"Durumu",products_count:"Ürün Adedi",updated_at:"Güncellenme Tarihi",created_at:"Eklenme Tarihi",actions:"İşlemler"},ie=()=>{f(!0),fetch(route("super.dealers.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{q(t.dealers)}).catch(t=>{console.log(t),i.current.show({severity:"error",summary:"Hata",detail:"Bayiler getirilirken bir hata oluştu."})}).finally(()=>{f(!1)})},ae=()=>{f(!0),fetch(route("super.products.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{J(t.products.map(s=>(s.total=s.price,s.quantity=1,s)))}).catch(t=>{console.log(t),i.current.show({severity:"error",summary:"Hata",detail:"Ürünler getirilirken bir hata oluştu."})}).finally(()=>{f(!1)})},oe=()=>{f(!0),fetch(route("super.orders.trashAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{Z(D),h(t.records),E(!0)}).catch(t=>{console.log(t),i.current.show({severity:"error",summary:"Hata",detail:"Çöp sepetindeki siparişler getirilirken bir hata oluştu."})}).finally(()=>{f(!1)})};r.useEffect(()=>{ie(),ae(),h(G)},[j]),r.useEffect(()=>{localStorage.setItem("selectedColumnsForOrdersTable",JSON.stringify(n))},[n]);const[L,k]=r.useState(!1),[P,T]=r.useState(!1),[_,N]=r.useState(!1),[I,le]=r.useState(!1),[ne,ce]=r.useState(!1),[de,ue]=r.useState(e.jsx(e.Fragment,{})),[pe,me]=r.useState(e.jsx(e.Fragment,{})),[x,S]=r.useState([]),[K,F]=r.useState(!1),[he,fe]=r.useState([]),[xe,ye]=r.useState(e.jsx(e.Fragment,{})),je=t=>{F(!0),fe(t)},ge=()=>e.jsx(e.Fragment,{children:e.jsx(Re,{start:()=>e.jsxs(e.Fragment,{children:[!w&&e.jsx(c,{icon:"pi pi-plus",size:"small",severity:"success",tooltip:"Yeni Sipariş Ekle",tooltipOptions:{position:"top"},onClick:()=>{k(!0)},className:"mr-2"}),e.jsx(c,{icon:"pi pi-bars",size:"small",severity:"info",tooltip:"Kolonları Yönet",tooltipOptions:{position:"top"},onClick:t=>{C.current.toggle(t)},className:"mr-2"}),!w&&!l&&e.jsx(c,{icon:d?"pi pi-folder-open":"pi pi-trash",size:"small",severity:"help",tooltip:d?"Çöp Sepetini Kapat":"Çöp Sepetini Görüntüle",tooltipOptions:{position:"top"},onClick:t=>{d?(h(W),E(!1)):oe()},className:"mr-2"}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"small",icon:"pi pi-times",className:"p-button-warning mr-2",onClick:()=>S([]),tooltip:"Seçimi Temizle",tooltipOptions:{position:"top"}}),e.jsx(c,{size:"small",onClick:t=>{B({target:t.currentTarget,message:d?`Seçilen ${S.length} siparişi geri yüklemek istediğinize emin misiniz?`:`Seçilen ${S.length} siparişi silmek istediğinize emin misiniz?`,icon:"pi pi-exclamation-triangle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>{let s=d?route("super.orders.restore"):route("super.orders.multipleDestroy");fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},body:JSON.stringify({recordIds:x.map(a=>a.id)})}).then(async a=>{let o=await a.json();a.status===404?i.current.show({severity:"error",summary:"Hata",detail:o.message}):a.status===500?i.current.show({severity:"warning",summary:"Hata",detail:o.message}):a.status===200&&(i.current.show({severity:"success",summary:"Başarılı",detail:o.message}),h(o.records))}).catch(a=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{S([])})},acceptLabel:d?"Geri Yükle":"Sil",rejectLabel:"Vazgeç"})},icon:d?"pi pi-sync":"pi pi-trash",className:d?"p-button-success mr-2":"p-button-danger mr-2",tooltip:d?`Seçilen ${x.length} siparişi geri yükle`:`Seçilen ${x.length} siparişi Sil`,tooltipOptions:{position:"top"}})]})]}),center:()=>e.jsx(e.Fragment,{children:e.jsxs("p",{className:"flex flex-col items-center justify-center",children:[d&&e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Çöp Sepeti"}),x.length>0&&e.jsxs("span",{children:[x.length," sipariş seçildi."]})]})})})}),Se=t=>e.jsx(Ee,{value:t.status_label,severity:t.status_severity}),ve=ge(),be=t=>{T(!0),ce(t)},we=t=>{let s=t.newRowData,a=t.rowData,o=t.rowIndex,y=new FormData;y.append("status",s.status),y.append("_method","PUT"),s.status!==a.status&&(f(!0),fetch(route("super.orders.statusUpdate",s.id),{method:"POST",headers:{"X-CSRF-TOKEN":m},body:y}).then(u=>u.json()).then(u=>{u.status?(u==null?void 0:u.dirty)!==!1&&(h(Ce=>{let v=[...Ce];return v[o].status_severity=g.find(z=>z.value===s.status).severity,v[o].status_label=g.find(z=>z.value===s.status).label,v[o].status=s.status,v[o].updated_at=u.updated_at,v}),i.current.show({severity:"success",summary:"İşlem Başarılı",detail:u.message})):i.current.show({severity:"error",summary:"Hata",detail:u.message})}).catch(u=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{f(!1)}))};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{title:"Siparişler"}),e.jsx(Me,{target:".custom-target-icon"}),e.jsx(De,{}),e.jsx(He,{ref:i}),e.jsx(X,{ref:O,showCloseIcon:!0,closeOnEscape:!0,children:e.jsx("p",{children:ee})}),e.jsx(X,{ref:C,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{children:"Kolonları Yönet"})}),e.jsxs("div",{className:"flex flex-col",children:[A.map((t,s)=>e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx(Oe,{inputId:t,checked:n.includes(t),onChange:a=>{let o=[...n];a.checked?o.push(t):o=o.filter(y=>y!==t),se(o)}}),e.jsx("label",{htmlFor:t,className:"ml-2",children:re[t]})]},s)),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(c,{label:"Kaydet",severity:"success",size:"small",onClick:()=>{C.current.hide()}})})]})]})}),e.jsxs(ze,{editMode:"cell",dragSelection:!0,value:D,removableSort:!0,paginator:!0,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,filters:{"dealer.name":{value:"",matchMode:"contains"},"user.name":{value:"",matchMode:"contains"},status:{value:null,matchMode:"equals"}},filterDisplay:"row",loading:U,selectionMode:"checkbox",selection:x,onSelectionChange:t=>{l||S(t.value)},header:ve,rowClassName:t=>t.deleted_at!==null?"blur-[.8px] hover:blur-none  ease-in duration-300":"",emptyMessage:"Sipariş bulunamadı.",rowHover:!0,dataKey:"id",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:[!l&&e.jsx(p,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),n.includes("id")&&e.jsx(p,{field:"id",header:"ID",sortable:!0}),n.includes("dealer")&&e.jsx(p,{field:"dealer.name",filter:!0,filterPlaceholder:"Bayi Adına Göre Filtreleyin",align:"center",body:t=>e.jsx(c,{link:!0,size:"small",label:t.dealer.name,onClick:()=>{l||Ne.visit(route("super.dealers.show",t.dealer.id))}}),sortable:!0,header:"Bayi Adı"}),n.includes("user")&&e.jsx(p,{field:"user.name",filter:!0,filterPlaceholder:"Yetkiliye Göre Filtreleyin",sortable:!0,header:"Yetkili"}),n.includes("status")&&e.jsx(p,{field:"status",header:"Durumu",body:Se,filter:!0,filterElement:t=>e.jsx(Y,{value:t.value,onChange:s=>t.filterApplyCallback(s.value),options:g,optionLabel:"label",className:"p-column-filter",showClear:!0}),editor:d||l===!0?null:t=>(Q(t.rowData.status),e.jsx(e.Fragment,{children:e.jsx(Y,{value:V,onChange:s=>t.editorCallback(s.value),options:g,optionLabel:"label",className:"w-full"})})),onCellEditComplete:we}),n.includes("products_count")&&e.jsx(p,{field:"products_count",body:t=>e.jsx(c,{link:!0,onClick:()=>{t.products_count===0?i.current.show({severity:"info",summary:"Bilgi",detail:"Siparişte ürün bulunmamaktadır."}):(N(!0),le(t.products))},tooltip:"Detayları Görmek İçin Tıklayınız.",label:t.products_count+" Adet",size:"small"}),sortable:!0,header:"Ürün Adedi"}),n.includes("price")&&j.user.role==="super"&&e.jsx(p,{field:"price",header:"Sipariş Tutarı",body:t=>Number(t.products.reduce((s,a)=>s+a.price,0)).toFixed(2)+" $",sortable:!0}),n.includes("created_at")&&e.jsx(p,{field:"created_at",sortable:!0,header:"Eklenme Tarihi",body:t=>new Date(t.created_at).toLocaleString()}),n.includes("updated_at")&&e.jsx(p,{field:"updated_at",sortable:!0,header:"Güncellenme Tarihi",body:t=>new Date(t.updated_at).toLocaleString()}),n.includes("actions")&&!d&&!l&&e.jsx(p,{field:"actions",header:"İşlemler",body:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center gap-x-2",children:[e.jsx(c,{icon:"pi pi-book",size:"small",tooltip:"Sipariş Notu",visible:t.note!=="",onClick:s=>{te(t.note),O.current.toggle(s)},tooltipOptions:{position:"top"},severity:"help"}),e.jsx(c,{icon:"pi pi-qrcode",size:"small",tooltip:"Ürün Kodları",onClick:()=>{je(t)},tooltipOptions:{position:"top"},severity:"success"}),!l&&e.jsx(c,{icon:"pi pi-pencil",size:"small",tooltip:"Siparişi Düzenle",onClick:()=>{be(t)},tooltipOptions:{position:"top"},severity:"warning"}),!l&&e.jsx(c,{icon:"pi pi-times",tooltip:"Siparişi Sil",tooltipOptions:{position:"top"},size:"small",onClick:s=>{B({target:s.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",accept:()=>{fetch(route("super.orders.destroy",t.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(async a=>{let o=await a.json();a.status===404?i.current.show({severity:"error",summary:"Hata",detail:o.message}):a.status===500?i.current.show({severity:"warning",summary:"Hata",detail:o.message}):a.status===200&&(i.current.show({severity:"success",summary:"Başarılı",detail:o.message}),h(y=>y.filter(u=>u.id!==t.id)))}).catch(a=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})})},acceptLabel:"Sil",rejectLabel:"Vazgeç"})},severity:"danger"})]})})})]}),e.jsx(b,{header:"Yeni Sipariş Ekle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>k(!1),maximizable:!0,visible:L,footer:de,children:e.jsx(Ae,{addModal:L,csrf_token:m,dealers:R,products:H,toast:i,initialDealer:l?j.user:null,dealerOrderPage:l,onHide:()=>k(!1),setRecords:h,setAddModalFooter:ue})}),e.jsx(b,{header:"Ürünler",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>N(!1),maximizable:!0,visible:_,footer:()=>e.jsx(c,{label:"Kapat",onClick:()=>N(!1),severity:"warning",size:"small"}),children:_&&e.jsxs("div",{className:"card flex flex-col",children:[I.map(t=>{let s=t.product;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx(Pe,{className:"w-[4rem] shadow-2 flex-shrink-0 border-round",preview:!0,src:s.image,alt:s.name}),e.jsxs("span",{className:"font-bold flex-1",children:[t.quantity," Adet - ",s.name," (#",s.sku,")"]}),j.user.role==="super"&&e.jsxs("span",{className:"font-bold text-900",children:["$ ",t.price]})]}),e.jsx(_e,{})]})}),j.user.role==="super"&&e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx("span",{className:"font-bold flex-1",children:"Toplam"}),e.jsxs("span",{className:"font-bold text-900",children:["$ ",I.reduce((t,s)=>t+s.price,0)]})]})]})}),!l&&e.jsx(b,{header:"Siparişi Düzenle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>T(!1),maximizable:!0,visible:P,footer:pe,children:e.jsx(Le,{updateModal:P,salesmans:$,statuses:g,dealerOrderPage:l,csrf_token:m,dealers:R,products:H,record:ne,toast:i,onHide:()=>T(!1),setRecords:h,setUpdateModalFooter:me})}),e.jsx(b,{header:"Ürün Kodları",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>F(!1),maximizable:!0,visible:K,footer:xe,children:e.jsx(Ie,{productCodesModal:K,order:he,setRecords:h,csrf_token:m,toast:i,onHide:()=>F(!1),setFooter:ye})})]})};return w||l?e.jsx(M,{}):e.jsx(Fe,{user:j.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Siparişler"}),children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx(M,{})})})})})}export{Ot as default};
