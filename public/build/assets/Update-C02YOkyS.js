import{r as i,j as t}from"./app-BsXU1hGf.js";import{D as g}from"./dropdown.esm-DuuA0AlA.js";import{F as m}from"./floatlabel.esm-DVl26oTh.js";import{B as C}from"./button.esm-B81BfYmi.js";import{M as H}from"./multiselect.esm-B6h0qkUt.js";import{D as K}from"./datatable.esm-D2kBNZfw.js";import{C as d}from"./column.esm-79J4UZiT.js";import{I as U}from"./inputnumber.esm-CYEvLmnb.js";import{I as G}from"./inputtextarea.esm-D_IBsX1z.js";/* empty css            */import"./ripple.esm-BLEVokoO.js";import"./index.esm-F8z-Nr5B.js";import"./index.esm-32o-Z-el.js";import"./index.esm-2kHtF-L_.js";import"./overlayservice.esm-r8pWTeSI.js";import"./tooltip.esm-BVFsxkC2.js";import"./csstransition.esm-DwBAzUfh.js";import"./index.esm-CJWoDjUz.js";import"./index.esm-D93Nm8Rp.js";import"./index.esm-BQBF9uge.js";import"./inputtext.esm-CNxswapE.js";import"./paginator.esm-IZhbKoeF.js";import"./index.esm-D3tEJ0rx.js";import"./index.esm-BUzHc4hV.js";import"./index.esm-xJ1k22CW.js";import"./index.esm-BFOz9IZW.js";function Se({dealers:k,addModal:B,record:s,setUpdateModalFooter:T,onHide:v,products:_,csrf_token:D,toast:x,setRecords:z,statuses:q,salesmans:E,auth:p}){const[u,L]=i.useState({id:s.dealer.id,name:s.dealer.name,email:s.dealer.email,phone:s.dealer.phone}),[c,M]=i.useState({id:s.user_id,label:s.user_label}),N=s.products.map(e=>{let a=e.product;return{category:a.category,id:a.id,name:a.name,price:a.price,sku:a.sku,quantity:e.quantity,total:Math.round(e.quantity*a.price*100)/100}}),[r,w]=i.useState(N),[f,I]=i.useState(s.note?s.note:""),[y,F]=i.useState(!1),[O,P]=i.useState(!1),[h,A]=i.useState(s.status),[j,b]=i.useState(!1);i.useEffect(()=>{let e=!1;if(r.forEach(a=>{s.products.find(n=>n.product_id===a.id)||(e=!0)}),s.products.forEach(a=>{r.find(n=>n.id===a.product_id)||(e=!0)}),(u==null?void 0:u.id)!==s.dealer.id||f!==s.note||h!==s.status||c.id!==s.user_id||e)b(!0);else{let a=N.reduce((n,o)=>n+o.total,0),l=r.reduce((n,o)=>n+o.total,0);b(a!==l)}P(!j)},[u,r,f,h,c,s]);const R=()=>{let e=new FormData;e.append("dealer_id",u.id),e.append("note",f);let a=r.map(l=>({product_id:l.id,quantity:l.quantity}));e.append("products",JSON.stringify(a)),e.append("_method","PUT"),e.append("status",h),e.append("user_id",c.id),F(!0),fetch(route("central.orders.update",s.id),{method:"POST",headers:{"X-CSRF-TOKEN":D},body:e}).then(l=>l.json()).then(l=>{l.status?(z(l.orders),x.current.show({severity:"success",summary:"İşlem Başarılı",detail:l.message}),v()):x.current.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{x.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{F(!1)})};i.useEffect(()=>{T(()=>t.jsxs(t.Fragment,{children:[t.jsx(C,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:v,loading:y}),t.jsx(C,{label:"Kaydet",icon:"pi pi-save",onClick:R,disabled:!j,size:"small",className:"p-button-success",loading:y})]}))},[B,u,y,O,j]);const Y=(e,a)=>{let l=e.value;w(n=>{let o=[...n],S=o.findIndex($=>$.id===a.id);return o[S].quantity=l,o[S].total=Math.round(l*o[S].price*100)/100,o})};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-10",children:[t.jsxs(m,{className:"w-full md:w-14rem mb-10",children:[t.jsx(g,{value:u,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:e=>L(e.value),options:k,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]}),t.jsxs(m,{className:"w-full mb-5",children:[t.jsx(H,{panelFooterTemplate:()=>{const e=r?r.length:0;return t.jsxs("div",{className:"py-2 px-3",children:[t.jsx("b",{children:e})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:e=>t.jsxs("span",{children:["#",e.sku," - ",e.name," - ",p.user.role==="super"&&t.jsxs(t.Fragment,{children:["- ",e.price," $"]})]}),virtualScrollerOptions:{itemSize:38},value:r,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:e=>w(e.value),options:_,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]}),t.jsxs(K,{value:r,showGridlines:!0,size:"small",className:r.length>0?"mx-auto":"hidden",children:[t.jsx(d,{field:"id",header:"#ID"}),t.jsx(d,{field:"name",header:"Ürün Adı"}),t.jsx(d,{field:"sku",header:"Ürün Stok kodu"}),p.user.role==="super"&&t.jsx(d,{field:"price",header:"Ürün Fiyatı"}),t.jsx(d,{header:"Adet",align:"center",body:e=>t.jsx(U,{showButtons:!0,suffix:" Adet",value:e.quantity,onChange:a=>Y(a,e)})}),p.user.role==="super"&&t.jsx(d,{field:"total",header:"Tutar",body:e=>t.jsxs("span",{children:[e.total," $"]})})]}),r.length>0&&p.user.role==="super"&&t.jsx("div",{className:"my-5",children:t.jsxs("h3",{children:["Toplam Tutar: ",r.reduce((e,a)=>e+a.total,0)," $"]})}),t.jsxs(m,{className:"mb-10",children:[t.jsx(G,{id:"order_note",value:f,onChange:e=>I(e.target.value),rows:5,className:"w-full"}),t.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]}),t.jsxs(m,{className:"w-full mb-10",children:[t.jsx(g,{value:h,onChange:e=>A(e.value),options:q,optionLabel:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Sipariş Durumu"})]}),t.jsxs(m,{className:"w-full md:w-14rem mb-10",children:[t.jsx(g,{emptyFilterMessage:"Yetkili Bulunamadı",value:c,filter:!0,onChange:e=>M(e.value),options:E,optionLabel:"label",filterBy:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Satış Yetkilisi"})]})]})})}export{Se as default};
