import{j as e,r as i,F as ze,a as De,y as Me}from"./app-ClrsTf0F.js";import{A as Re}from"./AuthenticatedLayout-DSU16mWj.js";import{D as He}from"./datatable.esm-V4wd1hco.js";import{C as u}from"./column.esm-B35lphBY.js";import{I as Oe}from"./inputtext.esm-BiSVeqXu.js";import{B as l}from"./button.esm-BdLbPjnf.js";import{T as Ee}from"./tooltip.esm-Ce4d-QiB.js";import{C as _e,c as G}from"./confirmpopup.esm-D4tv7yYZ.js";import{T as Le}from"./toolbar.esm-BlcbL6Ww.js";import{D as v}from"./dialog.esm-SWP2E-Lo.js";import{T as Ie}from"./toast.esm-CI85vIht.js";import{T as Pe}from"./tag.esm-BdiNQzV7.js";import{D as Ae}from"./dropdown.esm-qehlA5N7.js";import{C as Ke}from"./checkbox.esm-CIKZQZwM.js";import{O as $}from"./overlaypanel.esm-DoHuf_Y7.js";import Ye from"./Create-B8B7S2VD.js";import Be from"./Update-o3I0Ikcx.js";import{I as Xe}from"./image.esm-Bissi_Ti.js";import{D as Ge}from"./divider.esm-x3tyNRCU.js";import $e from"./ProductCodes-CfoHRhsd.js";import"./ApplicationLogo-CKPDd-42.js";import"./Dropdown-BccHHB98.js";import"./transition-BtKCOD1_.js";import"./ripple.esm-FqpoZDy7.js";import"./index.esm-a59ZHwdl.js";import"./paginator.esm-1zTVCqW2.js";import"./inputnumber.esm-Cq7BvTyL.js";import"./index.esm-CmL0spqv.js";import"./index.esm-B3y6ZoqB.js";import"./index.esm-DZsjv3A5.js";import"./index.esm-Cg7W4U2j.js";import"./index.esm-S9TjyNfq.js";import"./index.esm-DAis87B6.js";import"./overlayservice.esm-Ca__vUea.js";import"./csstransition.esm-DUPW-aq3.js";import"./index.esm-Bq0n2ixt.js";import"./index.esm-CcyJqw6R.js";import"./index.esm-lPNJbiMs.js";import"./steps.esm-C9EwNJ-I.js";import"./floatlabel.esm-C-KGKysD.js";import"./multiselect.esm-qBV8Edz_.js";import"./inputtextarea.esm-C5tVUnHk.js";import"./index.esm-BLSC95Xl.js";import"./treetable.esm-xZiYG0mK.js";import"./index.esm-Bb5IXCZm.js";import"./formik.esm-BRRs7c6_.js";import"./_baseClone-BgPU1wOP.js";function At({auth:f,ordersAll:U,csrf_token:m,statuses:b,salesmans:V,dealerPage:C=!1,dealerOrderPage:n=!1}){const D=()=>{const o=i.useRef(null),w=i.useRef(null),[M,q]=i.useState({global:{value:null,matchMode:ze.CONTAINS}}),[J,h]=i.useState(!1),[R,Q]=i.useState(""),[H,x]=i.useState(U),[O,W]=i.useState([]),[E,Z]=i.useState([]),[ee,te]=i.useState(null);i.useState([]);const[c,_]=i.useState(!1),[se,ie]=i.useState([]),L=["id","dealer","user","status","products_count","price","created_at","updated_at","actions"],[d,re]=i.useState(localStorage.getItem("selectedColumnsForOrdersTable")?JSON.parse(localStorage.getItem("selectedColumnsForOrdersTable")):L),ae={id:"ID",price:"Sipariş Tutarı",dealer:"Bayi",user:"Yetkili",status:"Durumu",products_count:"Ürün Adedi",updated_at:"Güncellenme Tarihi",created_at:"Eklenme Tarihi",actions:"İşlemler"},oe=()=>{h(!0),fetch(route("central.dealers.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{W(t.dealers)}).catch(t=>{console.log(t),o.current.show({severity:"error",summary:"Hata",detail:"Bayiler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})},le=()=>{h(!0),fetch(route("central.products.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{Z(t.products.map(s=>(s.total=s.price,s.quantity=1,s)))}).catch(t=>{console.log(t),o.current.show({severity:"error",summary:"Hata",detail:"Ürünler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})},ne=()=>{h(!0),fetch(route("central.orders.trashAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{ie(H),x(t.records),_(!0)}).catch(t=>{console.log(t),o.current.show({severity:"error",summary:"Hata",detail:"Çöp sepetindeki siparişler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})};i.useEffect(()=>{oe(),le()},[]),i.useEffect(()=>{localStorage.setItem("selectedColumnsForOrdersTable",JSON.stringify(d))},[d]);const I=(t,s=!1)=>{const r=s?t:t.target.value;let a={...M};a.global.value=r,q(a),Q(r)},[P,T]=i.useState(!1),[A,k]=i.useState(!1),[K,N]=i.useState(!1),[Y,ce]=i.useState(!1),[de,pe]=i.useState(!1),[ue,me]=i.useState(e.jsx(e.Fragment,{})),[he,xe]=i.useState(e.jsx(e.Fragment,{})),[y,g]=i.useState([]),[B,F]=i.useState(!1),[fe,ye]=i.useState([]),[je,ge]=i.useState(e.jsx(e.Fragment,{})),[Se,be]=i.useState(""),X=i.useRef(null),ve=t=>{F(!0),ye(t)},Ce=()=>e.jsx(e.Fragment,{children:e.jsx(Le,{start:()=>e.jsxs(e.Fragment,{children:[!C&&e.jsx(l,{icon:"pi pi-plus",size:"small",severity:"success",tooltip:"Yeni Sipariş Ekle",tooltipOptions:{position:"top"},onClick:()=>{T(!0)},className:"mr-2"}),e.jsx(l,{icon:"pi pi-bars",size:"small",severity:"info",tooltip:"Kolonları Yönet",tooltipOptions:{position:"top"},onClick:t=>{w.current.toggle(t)},className:"mr-2"}),!C&&!n&&e.jsx(l,{icon:c?"pi pi-folder-open":"pi pi-trash",size:"small",severity:"help",tooltip:c?"Çöp Sepetini Kapat":"Çöp Sepetini Görüntüle",tooltipOptions:{position:"top"},onClick:t=>{c?(x(se),_(!1)):ne()},className:"mr-2"}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"small",icon:"pi pi-times",className:"p-button-warning mr-2",onClick:()=>g([]),tooltip:"Seçimi Temizle",tooltipOptions:{position:"top"}}),e.jsx(l,{size:"small",onClick:t=>{G({target:t.currentTarget,message:c?`Seçilen ${g.length} siparişi geri yüklemek istediğinize emin misiniz?`:`Seçilen ${g.length} siparişi silmek istediğinize emin misiniz?`,icon:"pi pi-exclamation-triangle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>{let s=c?route("central.orders.restore"):route("central.orders.multipleDestroy");fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},body:JSON.stringify({recordIds:y.map(r=>r.id)})}).then(async r=>{let a=await r.json();r.status===404?o.current.show({severity:"error",summary:"Hata",detail:a.message}):r.status===500?o.current.show({severity:"warning",summary:"Hata",detail:a.message}):r.status===200&&(o.current.show({severity:"success",summary:"Başarılı",detail:a.message}),x(a.records))}).catch(r=>{o.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{g([])})},acceptLabel:c?"Geri Yükle":"Sil",rejectLabel:"Vazgeç"})},icon:c?"pi pi-sync":"pi pi-trash",className:c?"p-button-success mr-2":"p-button-danger mr-2",tooltip:c?`Seçilen ${y.length} siparişi geri yükle`:`Seçilen ${y.length} siparişi Sil`,tooltipOptions:{position:"top"}})]})]}),center:()=>e.jsx(e.Fragment,{children:e.jsxs("p",{className:"flex flex-col items-center justify-center",children:[c&&e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Çöp Sepeti"}),y.length>0&&e.jsxs("span",{children:[y.length," sipariş seçildi."]})]})}),end:()=>e.jsx(e.Fragment,{children:!c&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"p-input-icon-left",children:[e.jsx("i",{className:"pi pi-search"}),e.jsx(Oe,{size:"small",value:R,onChange:I,placeholder:"Siparişlerde Arama Yapın"})]}),R!==""&&e.jsx(l,{size:"small",icon:"pi pi-times",className:"p-button-info ml-2",onClick:()=>I("",!0),tooltip:"Filtreyi Temizle",tooltipOptions:{position:"top"}})]})})})}),we=t=>e.jsx(Pe,{value:t.status_label,severity:t.status_severity}),Te=Ce(),ke=t=>{k(!0),pe(t)},Ne=t=>{let s=t.newRowData,r=t.rowData,a=t.rowIndex,j=new FormData;j.append("status",s.status),j.append("_method","PUT"),s.status!==r.status&&(h(!0),fetch(route("central.orders.statusUpdate",s.id),{method:"POST",headers:{"X-CSRF-TOKEN":m},body:j}).then(p=>p.json()).then(p=>{p.status?(p==null?void 0:p.dirty)!==!1&&(x(Fe=>{let S=[...Fe];return S[a].status_severity=b.find(z=>z.value===s.status).severity,S[a].status_label=b.find(z=>z.value===s.status).label,S[a].status=s.status,S[a].updated_at=p.updated_at,S}),o.current.show({severity:"success",summary:"İşlem Başarılı",detail:p.message})):o.current.show({severity:"error",summary:"Hata",detail:p.message})}).catch(p=>{o.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{h(!1)}))};return e.jsxs(e.Fragment,{children:[e.jsx(De,{title:"Siparişler"}),e.jsx(Ee,{target:".custom-target-icon"}),e.jsx(_e,{}),e.jsx(Ie,{ref:o}),e.jsx($,{ref:w,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{children:"Kolonları Yönet"})}),e.jsxs("div",{className:"flex flex-col",children:[L.map((t,s)=>e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx(Ke,{inputId:t,checked:d.includes(t),onChange:r=>{let a=[...d];r.checked?a.push(t):a=a.filter(j=>j!==t),re(a)}}),e.jsx("label",{htmlFor:t,className:"ml-2",children:ae[t]})]},s)),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(l,{label:"Kaydet",severity:"success",size:"small",onClick:()=>{w.current.hide()}})})]})]})}),e.jsx($,{ref:X,showCloseIcon:!0,closeOnEscape:!0,children:e.jsx("p",{children:Se})}),e.jsxs(He,{editMode:"cell",dragSelection:!0,value:H,removableSort:!0,paginator:!0,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,filters:M,loading:J,globalFilterFields:[],selectionMode:"checkbox",selection:y,onSelectionChange:t=>{n||g(t.value)},header:Te,rowClassName:t=>t.deleted_at!==null?"blur-[.8px] hover:blur-none  ease-in duration-300":"",emptyMessage:"Sipariş bulunamadı.",rowHover:!0,dataKey:"id",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:[!n&&e.jsx(u,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),d.includes("id")&&e.jsx(u,{field:"id",header:"ID",sortable:!0}),d.includes("dealer")&&e.jsx(u,{field:"dealer.name",align:"center",body:t=>e.jsx(l,{link:!0,size:"small",label:t.dealer.name,onClick:()=>{n||Me.visit(route("central.dealers.show",t.dealer.id))}}),sortable:!0,header:"Bayi Adı"}),d.includes("user")&&e.jsx(u,{field:"user.name",sortable:!0,header:"Yetkili"}),d.includes("status")&&e.jsx(u,{field:"status",header:"Durumu",body:we,editor:c||n===!0?null:t=>(te(t.rowData.status),e.jsx(e.Fragment,{children:e.jsx(Ae,{value:ee,onChange:s=>t.editorCallback(s.value),options:b,optionLabel:"label",className:"w-full"})})),onCellEditComplete:Ne}),d.includes("products_count")&&e.jsx(u,{field:"products_count",body:t=>e.jsx(l,{link:!0,onClick:()=>{t.products_count===0?o.current.show({severity:"info",summary:"Bilgi",detail:"Siparişte ürün bulunmamaktadır."}):(N(!0),ce(t.products))},tooltip:"Detayları Görmek İçin Tıklayınız.",label:t.products_count+" Adet",size:"small"}),sortable:!0,header:"Ürün Adedi"}),d.includes("price")&&f.user.role==="super"&&e.jsx(u,{field:"price",header:"Sipariş Tutarı",body:t=>Number(t.products.reduce((s,r)=>s+r.price,0)).toFixed(2)+" $",sortable:!0}),d.includes("created_at")&&e.jsx(u,{field:"created_at",sortable:!0,header:"Eklenme Tarihi",body:t=>new Date(t.created_at).toLocaleString()}),d.includes("updated_at")&&e.jsx(u,{field:"updated_at",sortable:!0,header:"Güncellenme Tarihi",body:t=>new Date(t.updated_at).toLocaleString()}),d.includes("actions")&&!c&&!n&&e.jsx(u,{field:"actions",header:"İşlemler",body:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center gap-x-2",children:[e.jsx(l,{icon:"pi pi-book",size:"small",tooltip:"Sipariş Notu",visible:t.note!=="",onClick:s=>{be(t.note),X.current.toggle(s)},tooltipOptions:{position:"top"},severity:"help"}),e.jsx(l,{icon:"pi pi-qrcode",size:"small",tooltip:"Ürün Kodları",onClick:()=>{ve(t)},tooltipOptions:{position:"top"},severity:"success"}),!n&&e.jsx(l,{icon:"pi pi-pencil",size:"small",tooltip:"Siparişi Düzenle",onClick:()=>{ke(t)},tooltipOptions:{position:"top"},severity:"warning"}),!n&&e.jsx(l,{icon:"pi pi-times",tooltip:"Siparişi Sil",tooltipOptions:{position:"top"},size:"small",onClick:s=>{G({target:s.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",accept:()=>{fetch(route("central.orders.destroy",t.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(async r=>{let a=await r.json();r.status===404?o.current.show({severity:"error",summary:"Hata",detail:a.message}):r.status===500?o.current.show({severity:"warning",summary:"Hata",detail:a.message}):r.status===200&&(o.current.show({severity:"success",summary:"Başarılı",detail:a.message}),x(j=>j.filter(p=>p.id!==t.id)))}).catch(r=>{o.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})})},acceptLabel:"Sil",rejectLabel:"Vazgeç"})},severity:"danger"})]})})})]}),e.jsx(v,{header:"Yeni Sipariş Ekle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>T(!1),maximizable:!0,visible:P,footer:ue,children:e.jsx(Ye,{addModal:P,csrf_token:m,dealers:O,products:E,toast:o,auth:f,initialDealer:n?f.user:null,dealerOrderPage:n,onHide:()=>T(!1),setRecords:x,setAddModalFooter:me})}),e.jsx(v,{header:"Ürünler",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>N(!1),maximizable:!0,visible:K,footer:()=>e.jsx(l,{label:"Kapat",onClick:()=>N(!1),severity:"warning",size:"small"}),children:K&&e.jsxs("div",{className:"card flex flex-col",children:[Y.map(t=>{let s=t.product;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx(Xe,{className:"w-[4rem] shadow-2 flex-shrink-0 border-round",preview:!0,src:s.image,alt:s.name}),e.jsxs("span",{className:"font-bold flex-1",children:[t.quantity," Adet - ",s.name," (#",s.sku,")"]}),f.user.role==="super"&&e.jsxs("span",{className:"font-bold text-900",children:["$ ",t.price]})]}),e.jsx(Ge,{})]})}),f.user.role==="super"&&e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx("span",{className:"font-bold flex-1",children:"Toplam"}),e.jsxs("span",{className:"font-bold text-900",children:["$ ",Y.reduce((t,s)=>t+s.price,0)]})]})]})}),!n&&e.jsx(v,{header:"Siparişi Düzenle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>k(!1),maximizable:!0,visible:A,footer:he,children:e.jsx(Be,{updateModal:A,salesmans:V,statuses:b,dealerOrderPage:n,csrf_token:m,auth:f,dealers:O,products:E,record:de,toast:o,onHide:()=>k(!1),setRecords:x,setUpdateModalFooter:xe})}),e.jsx(v,{header:"Ürün Kodları",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>F(!1),maximizable:!0,visible:B,footer:je,children:e.jsx($e,{productCodesModal:B,order:fe,setRecords:x,csrf_token:m,toast:o,onHide:()=>F(!1),setFooter:ge})})]})};return C||n?e.jsx(D,{}):e.jsx(Re,{user:f.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Siparişler"}),children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx(D,{})})})})})}export{At as default};
