import{r,j as t}from"./app-CbKgTnfw.js";import{D as k}from"./dropdown.esm-5OCrWUkh.js";import{F as d}from"./floatlabel.esm-BqTxcGem.js";import{B as F}from"./button.esm-D0GGsqfP.js";import{M as J}from"./multiselect.esm-fUmmJntJ.js";import{D as V}from"./datatable.esm-bq0OClDD.js";import{C as c}from"./column.esm-iXUglLdf.js";import{I as X}from"./inputnumber.esm-B3C6OAA_.js";import{I as Q}from"./inputtextarea.esm-CjoJ30PW.js";import{I as _}from"./inputtext.esm-BCUyyFJJ.js";import"./ripple.esm-Bz0HPTmf.js";import"./index.esm-gqha0LF7.js";import"./index.esm-CZj6-l6V.js";import"./index.esm-CBE3UGX1.js";import"./overlayservice.esm-0pIkdLm4.js";import"./tooltip.esm-B0Fxn3I7.js";import"./csstransition.esm-CEurPmtU.js";import"./index.esm-CxG-i5f8.js";import"./index.esm-BwStUmvm.js";import"./index.esm-B9INqRdX.js";import"./paginator.esm--_xCwVYF.js";import"./index.esm-BHYNhjBT.js";import"./index.esm-jqxCJFL2.js";import"./index.esm-C6_txXFL.js";import"./index.esm-CoNLEXO0.js";function ve({dealers:T,addModal:B,record:a,setUpdateModalFooter:z,onHide:v,products:D,csrf_token:L,toast:j,setRecords:I,statuses:q,salesmans:E}){const[u,K]=r.useState({id:a.dealer.id,name:a.dealer.name,email:a.dealer.email,phone:a.dealer.phone}),[h,M]=r.useState({id:a.user_id,label:a.user_label}),[f,O]=r.useState(a.tracking_code||""),[x,U]=r.useState(a.tracking_url||""),N=a.products.map(e=>{let l=e.product;return{category:l.category,id:l.id,name:l.name,price:l.price,sku:l.sku,quantity:e.quantity,total:Math.round(e.quantity*l.price*100)/100}}),[i,w]=r.useState(N),[g,P]=r.useState(a.note?a.note:""),[y,C]=r.useState(!1),[R,A]=r.useState(!1),[m,Y]=r.useState(a.status),[b,p]=r.useState(!1);r.useEffect(()=>{let e=!1;if(i.forEach(l=>{a.products.find(n=>n.product_id===l.id)||(e=!0)}),a.products.forEach(l=>{i.find(n=>n.id===l.product_id)||(e=!0)}),(u==null?void 0:u.id)!==a.dealer.id||g!==a.note||m!==a.status||h.id!==a.user_id||f!==a.tracking_code||x!==a.tracking_url||e)p(!0);else{let l=N.reduce((n,o)=>n+o.total,0),s=i.reduce((n,o)=>n+o.total,0);p(l!==s)}A(!b)},[u,i,g,m,h,f,x,a]);const $=()=>{let e=new FormData;e.append("dealer_id",u.id),e.append("note",g),e.append("status",m),e.append("user_id",h.id),m==="shipping"&&(e.append("tracking_code",f),e.append("tracking_url",x));let l=i.map(s=>({product_id:s.id,quantity:s.quantity}));e.append("products",JSON.stringify(l)),e.append("_method","PUT"),C(!0),fetch(route("super.orders.update",a.id),{method:"POST",headers:{"X-CSRF-TOKEN":L},body:e}).then(s=>s.json()).then(s=>{s.status?(I(s.orders),j.current.show({severity:"success",summary:"İşlem Başarılı",detail:s.message}),v()):j.current.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{j.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{C(!1)})};r.useEffect(()=>{z(()=>t.jsxs(t.Fragment,{children:[t.jsx(F,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:v,loading:y}),t.jsx(F,{label:"Kaydet",icon:"pi pi-save",onClick:$,disabled:!b,size:"small",className:"p-button-success",loading:y})]}))},[B,u,y,R,b]);const H=(e,l)=>{let s=e.value;w(n=>{let o=[...n],S=o.findIndex(G=>G.id===l.id);return o[S].quantity=s,o[S].total=Math.round(s*o[S].price*100)/100,o})};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"py-10",children:[t.jsxs(d,{className:"w-full md:w-14rem mb-10",children:[t.jsx(k,{value:u,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:e=>K(e.value),options:T,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]}),t.jsxs(d,{className:"w-full mb-5",children:[t.jsx(J,{panelFooterTemplate:()=>{const e=i?i.length:0;return t.jsxs("div",{className:"py-2 px-3",children:[t.jsx("b",{children:e})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:e=>t.jsxs("span",{children:["#",e.sku," - ",e.name," - ",e.price," $"]}),virtualScrollerOptions:{itemSize:38},value:i,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:e=>w(e.value),options:D,optionLabel:"name",className:"w-full"}),t.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]}),t.jsxs(V,{value:i,showGridlines:!0,size:"small",className:i.length>0?"mx-auto":"hidden",children:[t.jsx(c,{field:"id",header:"#ID"}),t.jsx(c,{field:"name",header:"Ürün Adı"}),t.jsx(c,{field:"sku",header:"Ürün Stok kodu"}),t.jsx(c,{field:"price",header:"Ürün Fiyatı"}),t.jsx(c,{header:"Adet",align:"center",body:e=>t.jsx(X,{showButtons:!0,suffix:" Adet",value:e.quantity,onChange:l=>H(l,e)})}),t.jsx(c,{field:"total",header:"Tutar",body:e=>t.jsxs("span",{children:[e.total," $"]})})]}),i.length>0&&t.jsx("div",{className:"my-5",children:t.jsxs("h3",{children:["Toplam Tutar: ",i.reduce((e,l)=>e+l.total,0)," $"]})}),t.jsxs(d,{className:"mb-10",children:[t.jsx(Q,{id:"order_note",value:g,onChange:e=>P(e.target.value),rows:5,className:"w-full"}),t.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]}),t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(k,{value:m,onChange:e=>Y(e.value),options:q,optionLabel:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Sipariş Durumu"})]}),t.jsxs(d,{className:"w-full md:w-14rem mb-10",children:[t.jsx(k,{emptyFilterMessage:"Yetkili Bulunamadı",value:h,filter:!0,onChange:e=>M(e.value),options:E,optionLabel:"label",filterBy:"label",className:"w-full"}),t.jsx("label",{htmlFor:"dd-city",children:"Satış Yetkilisi"})]}),m==="shipping"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(_,{value:f,onChange:e=>{O(e.target.value),p(!0)},placeholder:"Kargo takip kodunu giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip Kodu"})]}),t.jsxs(d,{className:"w-full mb-10",children:[t.jsx(_,{value:x,onChange:e=>{U(e.target.value),p(!0)},placeholder:"Kargo takip URL'sini giriniz",className:"w-full"}),t.jsx("label",{children:"Kargo Takip URL (Opsiyonel)"})]})]})]})})}export{ve as default};
