import{j as e,r as i,F as ke,a as Te,y as Ne}from"./app-pP88dXXD.js";import{A as Fe}from"./AuthenticatedLayout-DvBwoLBe.js";import{D as ze}from"./datatable.esm-IL7QhP4E.js";import{C as p}from"./column.esm-Doa4u4hv.js";import{B as c}from"./button.esm-CvuNJ5B9.js";import{T as Me}from"./tooltip.esm-CzuGfRo8.js";import{C as De,c as B}from"./confirmpopup.esm-nBQ4BjYH.js";import{T as Re}from"./toolbar.esm-C_wtxwt5.js";import{D as v}from"./dialog.esm-D8aGFeEm.js";import{T as He}from"./toast.esm-Bp-ijC_d.js";import{T as Ee}from"./tag.esm-uz1AsYxS.js";import{D as Y}from"./dropdown.esm-BsJPZvZJ.js";import{C as Oe}from"./checkbox.esm-CxQwPHsS.js";import{O as X}from"./overlaypanel.esm-BGHcoKgQ.js";import Le from"./Create-Drdk1Abo.js";import Pe from"./Update-DpH-rWga.js";import{I as _e}from"./image.esm-CX5I0dkN.js";import{D as Ae}from"./divider.esm-CVbXKVbH.js";import Ie from"./ProductCodes-Bm2prgLU.js";import"./ApplicationLogo-B2oZSFQ4.js";import"./Dropdown-C8gXEep3.js";import"./transition-Dd-K9AW1.js";import"./ripple.esm-3EqM4Xiq.js";import"./index.esm-CK0Cgr2r.js";import"./paginator.esm-plLA5Nda.js";import"./inputnumber.esm-COJVyWG0.js";import"./inputtext.esm-CUVRfrTN.js";import"./index.esm-CXAUaRz9.js";import"./index.esm-DsVNKcbi.js";import"./index.esm-yMs_xicw.js";import"./index.esm-BeeN0Y3e.js";import"./index.esm-DYJS1BO8.js";import"./index.esm-BpWSIr-U.js";import"./overlayservice.esm-Bi8lrQ5u.js";import"./csstransition.esm-BBfra-DH.js";import"./index.esm-CoQrrDhV.js";import"./index.esm-DlBv1miS.js";import"./index.esm-Dml4Rf6J.js";import"./steps.esm-CxvGHh6C.js";import"./floatlabel.esm-Bqjmmks2.js";import"./multiselect.esm-SddbgUdU.js";import"./inputtextarea.esm-TZ2lf9wj.js";import"./index.esm-DHFyJffK.js";import"./treetable.esm-86RTBHB8.js";import"./index.esm-aZ-Dhbez.js";import"./formik.esm-DTaxErcu.js";import"./_baseClone-BgPU1wOP.js";function Et({auth:z,ordersAll:G,csrf_token:m,statuses:j,salesmans:$,dealerPage:b=!1,dealerOrderPage:l=!1}){const M=()=>{const r=i.useRef(null),w=i.useRef(null);i.useState({global:{value:null,matchMode:ke.CONTAINS}});const[U,h]=i.useState(!1);i.useState("");const[D,f]=i.useState(G),[R,q]=i.useState([]),[H,J]=i.useState([]),[V,Q]=i.useState(null);i.useState([]);const[d,E]=i.useState(!1),[W,Z]=i.useState([]),[ee,te]=i.useState(""),O=i.useRef(null),L=["id","dealer","user","status","products_count","price","created_at","updated_at","actions"],[n,se]=i.useState(localStorage.getItem("selectedColumnsForOrdersTable")?JSON.parse(localStorage.getItem("selectedColumnsForOrdersTable")):L),ie={id:"ID",price:"Sipariş Tutarı",dealer:"Bayi",user:"Yetkili",status:"Durumu",products_count:"Ürün Adedi",updated_at:"Güncellenme Tarihi",created_at:"Eklenme Tarihi",actions:"İşlemler"},re=()=>{h(!0),fetch(route("super.dealers.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{q(t.dealers)}).catch(t=>{console.log(t),r.current.show({severity:"error",summary:"Hata",detail:"Bayiler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})},ae=()=>{h(!0),fetch(route("super.products.listAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{J(t.products.map(s=>(s.total=s.price,s.quantity=1,s)))}).catch(t=>{console.log(t),r.current.show({severity:"error",summary:"Hata",detail:"Ürünler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})},oe=()=>{h(!0),fetch(route("super.orders.trashAll"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(t=>t.json()).then(t=>{Z(D),f(t.records),E(!0)}).catch(t=>{console.log(t),r.current.show({severity:"error",summary:"Hata",detail:"Çöp sepetindeki siparişler getirilirken bir hata oluştu."})}).finally(()=>{h(!1)})};i.useEffect(()=>{re(),ae()},[]),i.useEffect(()=>{localStorage.setItem("selectedColumnsForOrdersTable",JSON.stringify(n))},[n]);const[P,C]=i.useState(!1),[_,k]=i.useState(!1),[A,T]=i.useState(!1),[I,le]=i.useState(!1),[ne,ce]=i.useState(!1),[de,ue]=i.useState(e.jsx(e.Fragment,{})),[pe,me]=i.useState(e.jsx(e.Fragment,{})),[x,g]=i.useState([]),[K,N]=i.useState(!1),[he,fe]=i.useState([]),[xe,ye]=i.useState(e.jsx(e.Fragment,{})),je=t=>{N(!0),fe(t)},ge=()=>e.jsx(e.Fragment,{children:e.jsx(Re,{start:()=>e.jsxs(e.Fragment,{children:[!b&&e.jsx(c,{icon:"pi pi-plus",size:"small",severity:"success",tooltip:"Yeni Sipariş Ekle",tooltipOptions:{position:"top"},onClick:()=>{C(!0)},className:"mr-2"}),e.jsx(c,{icon:"pi pi-bars",size:"small",severity:"info",tooltip:"Kolonları Yönet",tooltipOptions:{position:"top"},onClick:t=>{w.current.toggle(t)},className:"mr-2"}),!b&&!l&&e.jsx(c,{icon:d?"pi pi-folder-open":"pi pi-trash",size:"small",severity:"help",tooltip:d?"Çöp Sepetini Kapat":"Çöp Sepetini Görüntüle",tooltipOptions:{position:"top"},onClick:t=>{d?(f(W),E(!1)):oe()},className:"mr-2"}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"small",icon:"pi pi-times",className:"p-button-warning mr-2",onClick:()=>g([]),tooltip:"Seçimi Temizle",tooltipOptions:{position:"top"}}),e.jsx(c,{size:"small",onClick:t=>{B({target:t.currentTarget,message:d?`Seçilen ${g.length} siparişi geri yüklemek istediğinize emin misiniz?`:`Seçilen ${g.length} siparişi silmek istediğinize emin misiniz?`,icon:"pi pi-exclamation-triangle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>{let s=d?route("super.orders.restore"):route("super.orders.multipleDestroy");fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},body:JSON.stringify({recordIds:x.map(a=>a.id)})}).then(async a=>{let o=await a.json();a.status===404?r.current.show({severity:"error",summary:"Hata",detail:o.message}):a.status===500?r.current.show({severity:"warning",summary:"Hata",detail:o.message}):a.status===200&&(r.current.show({severity:"success",summary:"Başarılı",detail:o.message}),f(o.records))}).catch(a=>{r.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{g([])})},acceptLabel:d?"Geri Yükle":"Sil",rejectLabel:"Vazgeç"})},icon:d?"pi pi-sync":"pi pi-trash",className:d?"p-button-success mr-2":"p-button-danger mr-2",tooltip:d?`Seçilen ${x.length} siparişi geri yükle`:`Seçilen ${x.length} siparişi Sil`,tooltipOptions:{position:"top"}})]})]}),center:()=>e.jsx(e.Fragment,{children:e.jsxs("p",{className:"flex flex-col items-center justify-center",children:[d&&e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Çöp Sepeti"}),x.length>0&&e.jsxs("span",{children:[x.length," sipariş seçildi."]})]})})})}),Se=t=>e.jsx(Ee,{value:t.status_label,severity:t.status_severity}),ve=ge(),be=t=>{k(!0),ce(t)},we=t=>{let s=t.newRowData,a=t.rowData,o=t.rowIndex,y=new FormData;y.append("status",s.status),y.append("_method","PUT"),s.status!==a.status&&(h(!0),fetch(route("super.orders.statusUpdate",s.id),{method:"POST",headers:{"X-CSRF-TOKEN":m},body:y}).then(u=>u.json()).then(u=>{u.status?(u==null?void 0:u.dirty)!==!1&&(f(Ce=>{let S=[...Ce];return S[o].status_severity=j.find(F=>F.value===s.status).severity,S[o].status_label=j.find(F=>F.value===s.status).label,S[o].status=s.status,S[o].updated_at=u.updated_at,S}),r.current.show({severity:"success",summary:"İşlem Başarılı",detail:u.message})):r.current.show({severity:"error",summary:"Hata",detail:u.message})}).catch(u=>{r.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{h(!1)}))};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{title:"Siparişler"}),e.jsx(Me,{target:".custom-target-icon"}),e.jsx(De,{}),e.jsx(He,{ref:r}),e.jsx(X,{ref:O,showCloseIcon:!0,closeOnEscape:!0,children:e.jsx("p",{children:ee})}),e.jsx(X,{ref:w,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{children:"Kolonları Yönet"})}),e.jsxs("div",{className:"flex flex-col",children:[L.map((t,s)=>e.jsxs("div",{className:"flex my-1 items-center",children:[e.jsx(Oe,{inputId:t,checked:n.includes(t),onChange:a=>{let o=[...n];a.checked?o.push(t):o=o.filter(y=>y!==t),se(o)}}),e.jsx("label",{htmlFor:t,className:"ml-2",children:ie[t]})]},s)),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(c,{label:"Kaydet",severity:"success",size:"small",onClick:()=>{w.current.hide()}})})]})]})}),e.jsxs(ze,{editMode:"cell",dragSelection:!0,value:D,removableSort:!0,paginator:!0,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,filters:{"dealer.name":{value:"",matchMode:"contains"},"user.name":{value:"",matchMode:"contains"},status:{value:null,matchMode:"equals"}},filterDisplay:"row",loading:U,selectionMode:"checkbox",selection:x,onSelectionChange:t=>{l||g(t.value)},header:ve,rowClassName:t=>t.deleted_at!==null?"blur-[.8px] hover:blur-none  ease-in duration-300":"",emptyMessage:"Sipariş bulunamadı.",rowHover:!0,dataKey:"id",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:[!l&&e.jsx(p,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),n.includes("id")&&e.jsx(p,{field:"id",header:"ID",sortable:!0}),n.includes("dealer")&&e.jsx(p,{field:"dealer.name",filter:!0,filterPlaceholder:"Bayi Adına Göre Filtreleyin",align:"center",body:t=>e.jsx(c,{link:!0,size:"small",label:t.dealer.name,onClick:()=>{l||Ne.visit(route("super.dealers.show",t.dealer.id))}}),sortable:!0,header:"Bayi Adı"}),n.includes("user")&&e.jsx(p,{field:"user.name",filter:!0,filterPlaceholder:"Yetkiliye Göre Filtreleyin",sortable:!0,header:"Yetkili"}),n.includes("status")&&e.jsx(p,{field:"status",header:"Durumu",body:Se,filter:!0,filterElement:t=>e.jsx(Y,{value:t.value,onChange:s=>t.filterApplyCallback(s.value),options:j,optionLabel:"label",className:"p-column-filter",showClear:!0}),editor:d||l===!0?null:t=>(Q(t.rowData.status),e.jsx(e.Fragment,{children:e.jsx(Y,{value:V,onChange:s=>t.editorCallback(s.value),options:j,optionLabel:"label",className:"w-full"})})),onCellEditComplete:we}),n.includes("products_count")&&e.jsx(p,{field:"products_count",body:t=>e.jsx(c,{link:!0,onClick:()=>{t.products_count===0?r.current.show({severity:"info",summary:"Bilgi",detail:"Siparişte ürün bulunmamaktadır."}):(T(!0),le(t.products))},tooltip:"Detayları Görmek İçin Tıklayınız.",label:t.products_count+" Adet",size:"small"}),sortable:!0,header:"Ürün Adedi"}),n.includes("price")&&e.jsx(p,{field:"price",header:"Sipariş Tutarı",body:t=>Number(t.products.reduce((s,a)=>s+a.price,0)).toFixed(2)+" $",sortable:!0}),n.includes("created_at")&&e.jsx(p,{field:"created_at",sortable:!0,header:"Eklenme Tarihi",body:t=>new Date(t.created_at).toLocaleString()}),n.includes("updated_at")&&e.jsx(p,{field:"updated_at",sortable:!0,header:"Güncellenme Tarihi",body:t=>new Date(t.updated_at).toLocaleString()}),n.includes("actions")&&!d&&!l&&e.jsx(p,{field:"actions",header:"İşlemler",body:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center gap-x-2",children:[e.jsx(c,{icon:"pi pi-book",size:"small",tooltip:"Sipariş Notu",visible:t.note!=="",onClick:s=>{te(t.note),O.current.toggle(s)},tooltipOptions:{position:"top"},severity:"help"}),e.jsx(c,{icon:"pi pi-qrcode",size:"small",tooltip:"Ürün Kodları",onClick:()=>{je(t)},tooltipOptions:{position:"top"},severity:"success"}),!l&&e.jsx(c,{icon:"pi pi-pencil",size:"small",tooltip:"Siparişi Düzenle",onClick:()=>{be(t)},tooltipOptions:{position:"top"},severity:"warning"}),!l&&e.jsx(c,{icon:"pi pi-times",tooltip:"Siparişi Sil",tooltipOptions:{position:"top"},size:"small",onClick:s=>{B({target:s.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",accept:()=>{fetch(route("super.orders.destroy",t.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m}}).then(async a=>{let o=await a.json();a.status===404?r.current.show({severity:"error",summary:"Hata",detail:o.message}):a.status===500?r.current.show({severity:"warning",summary:"Hata",detail:o.message}):a.status===200&&(r.current.show({severity:"success",summary:"Başarılı",detail:o.message}),f(y=>y.filter(u=>u.id!==t.id)))}).catch(a=>{r.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})})},acceptLabel:"Sil",rejectLabel:"Vazgeç"})},severity:"danger"})]})})})]}),e.jsx(v,{header:"Yeni Sipariş Ekle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>C(!1),maximizable:!0,visible:P,footer:de,children:e.jsx(Le,{addModal:P,csrf_token:m,dealers:R,products:H,toast:r,initialDealer:l?z.user:null,dealerOrderPage:l,onHide:()=>C(!1),setRecords:f,setAddModalFooter:ue})}),e.jsx(v,{header:"Ürünler",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>T(!1),maximizable:!0,visible:A,footer:()=>e.jsx(c,{label:"Kapat",onClick:()=>T(!1),severity:"warning",size:"small"}),children:A&&e.jsxs("div",{className:"card flex flex-col",children:[I.map(t=>{let s=t.product;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx(_e,{className:"w-[4rem] shadow-2 flex-shrink-0 border-round",preview:!0,src:s.image,alt:s.name}),e.jsxs("span",{className:"font-bold flex-1",children:[t.quantity," Adet - ",s.name," (#",s.sku,")"]}),e.jsxs("span",{className:"font-bold text-900",children:["$ ",t.price]})]}),e.jsx(Ae,{})]})}),e.jsxs("div",{className:"flex p-2 items-center gap-3 ",children:[e.jsx("span",{className:"font-bold flex-1",children:"Toplam"}),e.jsxs("span",{className:"font-bold text-900",children:["$ ",I.reduce((t,s)=>t+s.price,0)]})]})]})}),!l&&e.jsx(v,{header:"Siparişi Düzenle",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>k(!1),maximizable:!0,visible:_,footer:pe,children:e.jsx(Pe,{updateModal:_,salesmans:$,statuses:j,dealerOrderPage:l,csrf_token:m,dealers:R,products:H,record:ne,toast:r,onHide:()=>k(!1),setRecords:f,setUpdateModalFooter:me})}),e.jsx(v,{header:"Ürün Kodları",style:{width:"70vw"},breakpoints:{"960px":"75vw","641px":"100vw"},onHide:()=>N(!1),maximizable:!0,visible:K,footer:xe,children:e.jsx(Ie,{productCodesModal:K,order:he,setRecords:f,csrf_token:m,toast:r,onHide:()=>N(!1),setFooter:ye})})]})};return b||l?e.jsx(M,{}):e.jsx(Fe,{user:z.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Siparişler"}),children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx(M,{})})})})})}export{Et as default};
