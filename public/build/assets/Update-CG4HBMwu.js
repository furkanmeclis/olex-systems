import{r as n,j as e,c as f}from"./app-DYHyNKN7.js";import{I as P}from"./inputtextarea.esm-D6OXPpW_.js";import{I as C}from"./inputtext.esm-V7zHuWkI.js";import{I as w}from"./inputnumber.esm-CFhx3eoj.js";import{D as H}from"./dropdown.esm-pfxlAGhy.js";import{B as F}from"./button.esm-DU_nH01G.js";import{B as U}from"./blockui.esm-D1JM6Ln4.js";import{u as Y}from"./formik.esm-DrCe5rGg.js";import{c as Z,a as R,e as B}from"./index.esm-Fo31c6GN.js";import{M as J}from"./message.esm-BHsvx5LM.js";import{I as M}from"./inputswitch.esm-WTPXbsg7.js";import"./ripple.esm-BGxQRLkg.js";import"./tooltip.esm-Csu0gaGK.js";import"./index.esm-B34zjyqu.js";import"./index.esm-tnUHL2YI.js";import"./index.esm-Qud_urY_.js";import"./overlayservice.esm-D9C_91WQ.js";import"./csstransition.esm-qnoiCi2y.js";import"./index.esm-YmlpFJ13.js";import"./index.esm-CGiZOHsd.js";import"./_baseClone-BgPU1wOP.js";import"./index.esm-boBgQ27k.js";import"./index.esm-DsC-HLl0.js";function ge({categories:h,csrf_token:x,toast:c,onHide:g,setProducts:T,setUpdateModalFooter:z,updateModal:I,product:t}){const j=n.useRef(null),[y,K]=n.useState(h.map(s=>t.category===s.name?s:!1).filter(Boolean)[0]),[O,m]=n.useState(!1),[r,b]=n.useState(!1),[d,N]=n.useState(!1),[i,k]=n.useState(!1),v=n.useRef(),[A,D]=n.useState(!1),{values:l,handleSubmit:q,handleChange:u,setFieldValue:p,errors:S,setErrors:E}=Y({initialValues:{name:t.name,sku:t.sku,description:t.description,price:t.price,warranty:Number(String(t.warranty).split(" ")[0]),image:t.image,active:!!t.active},validationSchema:Z().shape({name:R().required("Ürün Adı Zorunludur."),sku:R().required("Ürün Stok Kodu Zorunludur."),price:B().required("Ürün Fiyatı Zorunludur."),warranty:B().required("Ürün Garanti Süresi Zorunludur.").min(1,"Ürün Garanti Süresi 1 Yıl'dan Az Olamaz.")}),onSubmit:s=>{if(r&&!r.status)return E({sku:`Stok Kodu Daha Önce Kullanılmış.
Lütfen Başka Bir Stok Kodu Giriniz.`}),!1;{N(!0);let a=new FormData;a.append("name",s.name),a.append("sku",s.sku),a.append("description",s.description),a.append("price",s.price),a.append("quantity",s.quantity),a.append("warranty",s.warranty),a.append("category",y.name),a.append("image",i),a.append("active",s.active),a.append("_method","PUT"),fetch(route("central.products.update",t.id),{method:"POST",headers:{"X-CSRF-TOKEN":x},body:a}).then(o=>o.json()).then(o=>{o.status?(c.current.show({severity:"success",summary:"Başarılı",detail:o.message}),T(o.products),g()):c.current.show({severity:"error",summary:"Hata",detail:o.message})}).catch(o=>{c.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{N(!1)})}}}),G=s=>{if(s.target.value.length<5)return m(!1),b(!1),!1;if(s.target.value===r.sku||s.target.value===t.sku)return!1;m(!0),fetch(route("central.products.controlSku"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x},body:JSON.stringify({sku:s.target.value})}).then(a=>a.json()).then(a=>{b({status:a.status,message:a.message,sku:a.sku})}).catch(a=>{c.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{m(!1)})},L=s=>{if(s.target.files.length===0)return k(!1),!1;const a=s.target.files[0];if(a.size>1024*1024*32)return c.current.show({severity:"error",summary:"Hata",detail:"Dosya Boyut 32MB'dan büyük olamaz."}),!1;if(!["image/jpeg","image/png","image/jpg"].includes(a.type))return c.current.show({severity:"error",summary:"Hata",detail:"Dosya Tipi Sadece JPG, JPEG, PNG olabilir."}),!1;k(a)};return n.useEffect(()=>{z(e.jsxs(e.Fragment,{children:[e.jsx(F,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:g,loading:d}),e.jsx(F,{label:"Kaydet",icon:"pi pi-save",size:"small",className:"p-button-success",loading:d,onClick:()=>{D(!0),v.current.click()}})]}))},[I]),e.jsx(U,{blocked:d,template:e.jsx("i",{className:"pi pi-spin pi-spinner",style:{fontSize:"3rem"}}),children:e.jsxs("form",{className:"p-fluid",onSubmit:q,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 mb-3",children:[e.jsx("div",{className:"col-span-2 grid gap-y-2",children:A&&Object.keys(S).length>0&&e.jsx(e.Fragment,{children:Object.entries(S).map(([s,a])=>e.jsx(J,{severity:"warn",text:a},s))})}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"font-bold",children:["Ürün Adı ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(C,{id:"name",name:"name",onChange:u,value:l.name,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sku",className:"font-bold",children:["Ürün Stok Kodu ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:f("pi pi-barcode",{"text-green-400":r&&r.status,"text-red-400":r&&!r.status})})}),e.jsx(C,{name:"sku",onChange:u,value:l.sku,id:"sku",tooltip:r&&r.message,tooltipOptions:{position:"bottom"},onBlur:s=>G(s)}),O&&e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-spin pi-spinner"})}),r&&r.status&&e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-check text-green-400"})}),r&&!r.status&&e.jsx("span",{className:"p-inputgroup-addon",children:e.jsx("i",{className:"pi pi-times text-red-400"})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"font-bold",children:"Ürün Açıklaması"}),e.jsx(P,{id:"description",name:"description",onChange:u,value:l.description,rows:3,cols:20})]}),e.jsxs("div",{className:"mb-3 flex justify-start items-center gap-x-2",children:[e.jsx(M,{checked:l.active,inputId:"productActive",onChange:s=>p("active",s.value)}),e.jsxs("label",{htmlFor:"productActive",className:"font-bold",children:["Ürün Aktifliği (",l.active?"Aktif":"Pasif",")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 mb-3",children:[e.jsxs("div",{className:"field col",children:[e.jsxs("label",{className:"font-bold",children:["Ürün Garanti Süresi (Yıl) ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(w,{name:"warranty",value:l.warranty,onChange:s=>{p("warranty",s.value)},min:0,max:100,suffix:" Yıl"})]}),e.jsxs("div",{className:"field col",children:[e.jsx("label",{htmlFor:"quantity",className:"font-bold",children:"Ürün Kategorisi"}),e.jsx(H,{value:y,onChange:s=>K(s.value),options:h,optionLabel:"name",placeholder:"Kategori Seçin",className:"w-full md:w-14rem"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"field",children:[e.jsxs("label",{htmlFor:"price",className:"font-bold",children:["Ürün Fiyatı ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(w,{id:"price",mode:"currency",value:l.price,name:"price",onChange:s=>{p("price",s.value)},currency:"USD",locale:"tr-TR"})]})}),e.jsx("label",{className:"font-bold ",htmlFor:"image",children:"Ürün Resmi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 my-3",children:[e.jsxs("div",{className:"flex justify-center",children:[e.jsx("input",{id:"image",ref:j,type:"file",className:"hidden",accept:"image/*",onChange:L}),e.jsxs("div",{className:f("w-44 border-dashed border  h-44 cursor-pointer bg-gray-600/30 rounded-full flex justify-center items-center",{"border-orange-400":i===!1,"border-green-400":i!==!1}),onClick:()=>{j.current.click()},children:[i===!1&&e.jsx("i",{className:"pi pi-camera text-2xl text-orange-400"}),i!==!1&&e.jsx("i",{className:"pi pi-check text-2xl text-green-400"})]})]}),e.jsx("div",{children:e.jsx("img",{src:i!==!1?URL.createObjectURL(i):l.image,alt:i.name,className:f("w-full h-full max-h-44 bg-gray-300/10 border border-dashed object-contain rounded-lg",{"border-orange-400":i===!1,"border-green-400":i!==!1})})})]}),e.jsx("button",{type:"submit",style:{display:"none"},ref:v})]})})}export{ge as default};
