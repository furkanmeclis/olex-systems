import{r as i,j as e}from"./app-B0Xag5vm.js";import{S as M}from"./steps.esm-C6gxmKgr.js";import{D as R}from"./divider.esm-B6Cl4nKI.js";import{D as _}from"./dropdown.esm-B2y4tOjl.js";import{F as y}from"./floatlabel.esm-C96st5VB.js";import{B as p}from"./button.esm-CdtlnTz5.js";import{M as G}from"./multiselect.esm-_gQ3_Diu.js";import{D as $}from"./datatable.esm-C3ZFJQqr.js";import{C as m}from"./column.esm-BZ0rbR1D.js";import{I as H}from"./inputnumber.esm-BMnqchoX.js";import{I as K}from"./inputtextarea.esm-CZhCu1xI.js";import"./ripple.esm-CDYa-oWb.js";import"./index.esm-CWphjh0p.js";import"./index.esm-C_1UxxSh.js";import"./index.esm-DRr3eaqO.js";import"./overlayservice.esm-C0zaFI8v.js";import"./tooltip.esm-C99wVij7.js";import"./csstransition.esm-DoZjE4GP.js";import"./index.esm-CftuEaaM.js";import"./index.esm-Djr8Bcws.js";import"./index.esm-DwEsdbYO.js";import"./inputtext.esm-CU5mHEyi.js";import"./paginator.esm-BgUKXpH4.js";import"./index.esm-CNb1qswM.js";import"./index.esm-DxCYw3OJ.js";import"./index.esm-Dep4HqQy.js";import"./index.esm-Ka8oV4Qk.js";function ye({dealers:k,addModal:B,setAddModalFooter:D,onHide:b,products:T,csrf_token:z,toast:f,setRecords:I,initialDealer:h=null,dealerOrderPage:n}){const[r,o]=i.useState(0),[c,S]=i.useState(null),[a,g]=i.useState([]),[q,E]=i.useState(""),[d,v]=i.useState(!1),[x,u]=i.useState(!1),[F,J]=i.useState([{label:"Bayi Seçimi"},{label:"Ürün Seçimi"},{label:"Adet Girimi"},{label:"Ek Bilgiler"}]);i.useEffect(()=>{(h!==null||n)&&(S(h),o(1))},[h,n]);const w=(t=!1)=>{if(r===0)c==null?u(!0):(u(!1),t&&o(r+1));else if(r===1)a.length>0?(u(!1),t&&o(r+1)):u(!0);else if(r===2){let l=!0;a.forEach(s=>{(s.quantity===null||s.quantity===void 0||s.quantity===0)&&(l=!1)}),l?(u(!1),t&&o(r+1)):u(!0)}},C=i.useRef(null),A=()=>{let t=new FormData;t.append("dealer_id",c.id),t.append("note",C.current.value);let l=a.map(s=>({product_id:s.id,quantity:s.quantity}));t.append("products",JSON.stringify(l)),v(!0),fetch(route("super.orders.store"),{method:"POST",headers:{"X-CSRF-TOKEN":z},body:t}).then(s=>s.json()).then(s=>{s.status?(I(s.orders),f.current.show({severity:"success",summary:"İşlem Başarılı",detail:s.message}),b()):f.current.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{f.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{v(!1)})};i.useEffect(()=>{D(()=>(w(),e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Vazgeç",icon:"pi pi-times",size:"small",link:!0,onClick:b,loading:d}),r!==0&&!(r===1&&n===!0)&&e.jsx(p,{label:"Geri",icon:"pi pi-arrow-left",size:"small",className:"p-button-warning",onClick:()=>o(r-1),loading:d}),r===F.length-1?e.jsx(p,{label:"Kaydet",icon:"pi pi-save",onClick:A,disabled:x,size:"small",className:"p-button-success",loading:d}):e.jsx(p,{label:"İleri",icon:"pi pi-arrow-right",disabled:x,size:"small",className:"p-button-success",onClick:()=>w(!0),loading:d})]})))},[B,r,c,d,x,a]);const L=(t,l)=>{let s=t.value,N=[...a],j={...l};j.quantity=s,j.total=Math.round(s*l.price*100)/100,N[a.indexOf(l)]=j,g(N)};return e.jsxs(e.Fragment,{children:[e.jsx(M,{model:F,onSelect:t=>o(t.index),activeIndex:r,className:"mb-10"}),e.jsxs("div",{children:[r===0&&e.jsx(e.Fragment,{children:e.jsxs(y,{className:"w-full md:w-14rem",children:[e.jsx(_,{value:c,filter:!0,showClear:!0,emptyFilterMessage:"Bayi Bulunamadı",filterBy:"name,email,phone",onChange:t=>S(t.value),options:k,optionLabel:"name",className:"w-full"}),e.jsx("label",{htmlFor:"dd-city",children:"Bayi Seçiniz"})]})}),r===1&&e.jsx(e.Fragment,{children:e.jsxs(y,{className:"w-full",children:[e.jsx(G,{panelFooterTemplate:()=>{const t=a?a.length:0;return e.jsxs("div",{className:"py-2 px-3",children:[e.jsx("b",{children:t})," ürün seçili."]})},filter:!0,showClear:!0,itemTemplate:t=>e.jsxs("span",{children:["#",t.sku," - ",t.name," ",!n&&e.jsxs(e.Fragment,{children:["- ",t.price," $"]})]}),value:a,emptyFilterMessage:"Ürün Bulunamadı",filterBy:"name,sku,price",onChange:t=>g(t.value),options:T,optionLabel:"name",className:"w-full"}),e.jsx("label",{htmlFor:"ms-cities",children:"Ürünleri Seçiniz"})]})}),r===2&&e.jsxs(e.Fragment,{children:[e.jsxs($,{value:a,showGridlines:!0,children:[e.jsx(m,{field:"id",header:"#ID"}),e.jsx(m,{field:"name",header:"Ürün Adı"}),e.jsx(m,{field:"sku",header:"Ürün Stok kodu"}),!n&&e.jsx(m,{field:"price",header:"Ürün Fiyatı"}),e.jsx(m,{header:"Adet",align:"center",body:t=>e.jsx(H,{showButtons:!0,suffix:" Adet",value:t.quantity,onChange:l=>L(l,t)})}),!n&&e.jsx(m,{field:"total",header:"Tutar",body:t=>e.jsxs("span",{children:[t.total," $"]})})]}),e.jsx(R,{}),!n&&e.jsx("div",{children:e.jsxs("h3",{children:["Toplam Tutar: ",a.reduce((t,l)=>t+l.total,0)," $"]})})]}),r===3&&e.jsx(e.Fragment,{children:e.jsxs(y,{children:[e.jsx(K,{ref:C,id:"order_note",value:q,onChange:t=>E(t.target.value),rows:5,className:"w-full"}),e.jsx("label",{htmlFor:"order_note",children:"Sipariş Notu"})]})})]})]})}export{ye as default};
